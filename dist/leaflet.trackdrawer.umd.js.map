{"version":3,"file":"leaflet.trackdrawer.umd.js","sources":["../src/Colors.js","../src/LayerContainer.js","../src/Edge.js","../src/Track.js","../src/ToolBar.js","../src/TraceModeBar.js","../src/Node.js","../src/LatLngUtils.js","../src/Loader.js","../src/index.js"],"sourcesContent":["const colorMap = {\n  red: '#D63E2A',\n  orange: '#F59630',\n  green: '#72B026',\n  blue: '#38AADD',\n  purple: '#D252B9',\n  darkred: '#A23336',\n  darkblue: '#0067A3',\n  darkgreen: '#728224',\n  darkpurple: '#5B396B',\n  cadetblue: '#436978',\n  lightred: '#FF8E7F',\n  beige: '#FFCB92',\n  lightgreen: '#BBF970',\n  lightblue: '#8ADAFF',\n  pink: '#FF91EA',\n  white: '#FBFBFB',\n  lightgray: '#A3A3A3',\n  gray: '#575757',\n  black: '#303030',\n};\nconst colors = [\n  'blue',\n  'green',\n  'orange',\n  'purple',\n  'red',\n  'darkblue',\n  'darkpurple',\n  'lightblue',\n  'lightgreen',\n  'beige',\n  'pink',\n  'lightred',\n]; // Colors supported by Leaflet AwesomeMarkers\n\nObject.freeze(colorMap);\nObject.freeze(colors);\n\nmodule.exports = {\n  nameOf(idx) {\n    return colors[idx % colors.length];\n  },\n\n  rgbOf(idx) {\n    return colorMap[this.nameOf(idx)];\n  },\n\n  nameToRgb(name) {\n    return colorMap[name];\n  },\n\n  rgbToName(rgb) {\n    return Object.keys(colorMap).find((key) => colorMap[key] === rgb);\n  },\n};\n","const L = require('leaflet');\n\nmodule.exports = L.Evented.extend({\n  initialize(parent) {\n    this._parent = parent;\n    const f = L.featureGroup()\n      .addTo(parent)\n      .addEventParent(this);\n    this._elements = [f];\n    this.length = 1;\n  },\n\n  get(i) {\n    const idx = i < 0 ? this._elements.length + i : i;\n    return this._elements[idx];\n  },\n\n  /* eslint-disable prefer-rest-params */\n  splice() {\n    const ret = this._elements.splice(...arguments);\n    ret.forEach((x) => x.removeFrom(this._parent).removeEventParent(this));\n\n    if (arguments.length > 2) {\n      const args = Array.prototype.slice.call(arguments, 2);\n      args.forEach((x) => {\n        x.addTo(this._parent).addEventParent(this);\n      });\n    }\n\n    this.length = this._elements.length;\n    return ret;\n  },\n  /* eslint-enable prefer-rest-params */\n\n  forEach(cb) {\n    this._elements.forEach(cb);\n  },\n\n  clean() {\n    this._elements[0].clearLayers();\n    this.splice(1);\n  },\n\n  getLayer(id) {\n    const parentLayer = this._elements.find((x) => x.getLayer(id) !== undefined);\n    return parentLayer !== undefined ? parentLayer.getLayer(id) : undefined;\n  },\n  getLayerId(layer) {\n    const parentLayer = this._elements.find((x) => x.hasLayer(layer));\n    return parentLayer !== undefined ? parentLayer.getLayerId(layer) : undefined;\n  },\n  getLayerIndex(layer) {\n    return this._elements.findIndex((x) => x.hasLayer(layer));\n  },\n});\n","const L = require('leaflet');\n\nconst Edge = L.Polyline.extend({\n  _startMarkerId: undefined,\n  _endMarkerId: undefined,\n  _promoted: false,\n  _demoted: true,\n  _computation: 0,\n\n  options: { metadata: {} },\n\n  initialize(latlngs, options) {\n    L.Polyline.prototype.initialize.call(this, latlngs, options);\n    L.setOptions(this, options);\n    this.options.metadata = JSON.parse(JSON.stringify(this.options.metadata));\n  },\n});\n\nmodule.exports = {\n  Edge,\n  edge(latlngs, options) {\n    return new Edge(latlngs, options);\n  },\n};\n","const L = require('leaflet');\nconst Colors = require('./Colors');\nconst LayerContainer = require('./LayerContainer');\nconst { Edge } = require('./Edge');\n\nfunction encodeLatLngs(latlngs) {\n  const array = [];\n  const size = latlngs.length;\n  for (let i = 0; i < size; i += 1) {\n    array.push(latlngs[i].lat);\n    array.push(latlngs[i].lng);\n  }\n  return array;\n\n  /* polyline with precision of 8 seems broken\n\n    var array = latlngs.map(function(x) {\n      return [x.lat, x.lng];\n    });\n\n    return polyline.encode(array, 8); //\n    */\n}\n\nfunction decodeLatLngs(latlngs) {\n  const array = [];\n  const size = latlngs.length;\n  for (let i = 0; i < size; i += 2) {\n    array.push(L.latLng(latlngs[i], latlngs[i + 1]));\n  }\n  return array;\n\n  /* polyline with precision of 8 seems broken\n\n    var decoded = polyline.decode(latlngs, 8);\n\n    return decoded.map(function(x) {\n      return L.latLng(x[0], x[1]);\n    });\n    */\n}\n\nfunction encodeLatLng(latlng) {\n  return [latlng.lat, latlng.lng];\n}\n\nfunction decodeLatLng(latlng) {\n  return L.latLng(latlng[0], latlng[1]);\n}\n\nconst Track = L.LayerGroup.extend({\n  options: {\n    routingCallback: undefined,\n    router: undefined,\n    debug: false,\n    undoable: true,\n    undoDepth: 30,\n  },\n\n  _getPrevious(node) {\n    const previousEdge = node !== undefined ? this._getEdge(node._routeIdPrevious) : undefined;\n    const previousNode = previousEdge !== undefined ? this._getNode(previousEdge._startMarkerId) : undefined;\n    return { previousEdge, previousNode };\n  },\n\n  _getNext(node) {\n    const nextEdge = node !== undefined ? this._getEdge(node._routeIdNext) : undefined;\n    const nextNode = nextEdge !== undefined ? this._getNode(nextEdge._endMarkerId) : undefined;\n    return { nextEdge, nextNode };\n  },\n\n  _getNodeId(node) {\n    return this._nodesContainers.getLayerId(node);\n  },\n  _getEdgeId(edge) {\n    return this._edgesContainers.getLayerId(edge);\n  },\n  _getNode(id) {\n    return this._nodesContainers.getLayer(id);\n  },\n  _getEdge(id) {\n    return this._edgesContainers.getLayer(id);\n  },\n  _getNodeContainerIndex(node) {\n    return this._nodesContainers.getLayerIndex(node);\n  },\n  _getNodeContainer(node) {\n    return this._nodesContainers.get(this._getNodeContainerIndex(node));\n  },\n  _getEdgeContainerIndex(edge) {\n    return this._edgesContainers.getLayerIndex(edge);\n  },\n  _getEdgeContainer(edge) {\n    return this._edgesContainers.get(this._getEdgeContainerIndex(edge));\n  },\n\n  initialize(options) {\n    this.setOptions(options);\n    L.LayerGroup.prototype.initialize.call(this);\n\n    this._nodesContainers = new LayerContainer(this);\n    this._edgesContainers = new LayerContainer(this);\n    this._firstNodeId = undefined;\n    this._lastNodeId = undefined;\n    this._currentColorIndex = 0;\n    this._fireEvents = true;\n    this._computing = 0;\n\n    this._states = null;\n    this._currentStateIndex = null;\n\n    if (this.options.undoable) {\n      this._states = [];\n      this._states.push(this.getState());\n      this._currentStateIndex = 0;\n    }\n  },\n\n  setOptions(options) {\n    L.setOptions(this, options);\n\n    if (this.options.router !== undefined) {\n      this.options.routingCallback = (previousMarker, marker, done) => {\n        this.options.router.route(\n          [L.Routing.waypoint(previousMarker.getLatLng()), L.Routing.waypoint(marker.getLatLng())],\n          (err, result) => {\n            done(err, result ? result[0].coordinates : null, {});\n          },\n        );\n      };\n    }\n  },\n\n  hasNodes(count = 1) {\n    let counter = 0;\n    this._nodesContainers.forEach((container) => {\n      const group = container.getLayers();\n      counter += group.length;\n    });\n    return counter >= count;\n  },\n\n  getNodes() {\n    const nodes = [];\n\n    this._nodesContainers.forEach((container) => {\n      const group = container.getLayers();\n      if (group.length > 0) nodes.push({ container, markers: group });\n    });\n\n    return nodes;\n  },\n  getNodesContainer() {\n    return this._nodesContainers;\n  },\n\n  getSteps() {\n    const steps = [];\n\n    this._edgesContainers.forEach((container) => {\n      const group = container.getLayers();\n      if (group.length > 0) steps.push({ container, edges: group });\n    });\n\n    return steps;\n  },\n  getStepsContainer() {\n    return this._edgesContainers;\n  },\n\n  getBounds() {\n    const bounds = L.latLngBounds([]);\n\n    this._nodesContainers.forEach((container) => {\n      bounds.extend(container.getBounds());\n    });\n\n    this._edgesContainers.forEach((container) => {\n      bounds.extend(container.getBounds());\n    });\n    return bounds;\n  },\n\n  getLatLngs() {\n    const hasTrackStats = L.TrackStats !== undefined;\n    const latlngs = [];\n\n    let currentNode = this._getNode(this._firstNodeId);\n    this._nodesContainers.forEach(() => {\n      const l = [];\n      do {\n        const { nextEdge, nextNode } = this._getNext(currentNode);\n        if (currentNode === undefined || nextEdge === undefined) {\n          break;\n        }\n\n        nextEdge.getLatLngs().forEach((e) => {\n          l.push(hasTrackStats ? L.TrackStats.cache.getAll(e) : e);\n        });\n\n        currentNode = nextNode;\n      } while (currentNode.options.type !== 'stopover');\n\n      latlngs.push(JSON.parse(JSON.stringify(l)));\n    });\n\n    return latlngs;\n  },\n\n  _stopoversToGeoJSON() {\n    const stopovers = [];\n    const features = [];\n\n    let currentNode = this._getNode(this._firstNodeId);\n\n    if (currentNode !== undefined) {\n      stopovers.push(currentNode);\n    }\n    this._nodesContainers.forEach(() => {\n      do {\n        const { nextEdge, nextNode } = this._getNext(currentNode);\n        if (currentNode === undefined || nextEdge === undefined) {\n          break;\n        }\n\n        currentNode = nextNode;\n      } while (currentNode.options.type !== 'stopover');\n\n      if (currentNode !== undefined) {\n        stopovers.push(currentNode);\n      }\n    });\n\n    const hasTrackStats = L.TrackStats !== undefined;\n    stopovers.forEach((node, idx) => {\n      const e = hasTrackStats ? L.TrackStats.cache.getAll(node.getLatLng()) : node.getLatLng();\n      const properties = JSON.parse(JSON.stringify(node.options.metadata));\n      properties.index = idx;\n\n      features.push({\n        type: 'Feature',\n        properties,\n        geometry: {\n          type: 'Point',\n          coordinates: 'z' in e && e.z !== null ? [e.lng, e.lat, e.z] : [e.lng, e.lat],\n        },\n      });\n    });\n\n    return features;\n  },\n\n  _edgesToFlatGeoJSON() {\n    const hasTrackStats = L.TrackStats !== undefined;\n    const feature = {\n      type: 'Feature',\n      properties: { index: 0 },\n      geometry: {\n        type: 'LineString',\n        coordinates: [],\n      },\n    };\n\n    let currentNode = this._getNode(this._firstNodeId);\n    this._nodesContainers.forEach(() => {\n      do {\n        const { nextEdge, nextNode } = this._getNext(currentNode);\n        if (currentNode === undefined || nextEdge === undefined) {\n          break;\n        }\n\n        nextEdge.getLatLngs().forEach((e) => {\n          const e2 = hasTrackStats ? L.TrackStats.cache.getAll(e) : e;\n          feature.geometry.coordinates.push('z' in e2 && e2.z !== null ? [e2.lng, e2.lat, e2.z] : [e2.lng, e2.lat]);\n        });\n\n        currentNode = nextNode;\n      } while (currentNode.options.type !== 'stopover');\n    });\n\n    return feature;\n  },\n\n  _edgesToGeoJSON() {\n    const hasTrackStats = L.TrackStats !== undefined;\n    const features = [];\n\n    let currentNode = this._getNode(this._firstNodeId);\n    this._nodesContainers.forEach((_c, idx) => {\n      do {\n        const { nextEdge, nextNode } = this._getNext(currentNode);\n        if (currentNode === undefined || nextEdge === undefined) {\n          break;\n        }\n\n        const properties = JSON.parse(JSON.stringify(nextEdge.options.metadata));\n        properties.index = idx;\n\n        const feature = {\n          type: 'Feature',\n          properties,\n          geometry: {\n            type: 'LineString',\n            coordinates: [],\n          },\n        };\n\n        nextEdge.getLatLngs().forEach((e) => {\n          const e2 = hasTrackStats ? L.TrackStats.cache.getAll(e) : e;\n          feature.geometry.coordinates.push('z' in e2 && e2.z !== null ? [e2.lng, e2.lat, e2.z] : [e2.lng, e2.lat]);\n        });\n\n        features.push(feature);\n\n        currentNode = nextNode;\n      } while (currentNode.options.type !== 'stopover');\n    });\n\n    return features;\n  },\n\n  toGeoJSON(exportStopovers = true, exportAsFlat = false) {\n    const geojson = {\n      type: 'FeatureCollection',\n      features: [],\n    };\n\n    if (exportStopovers) {\n      this._stopoversToGeoJSON().forEach((f) => geojson.features.push(f));\n    }\n\n    if (exportAsFlat) {\n      geojson.features.push(this._edgesToFlatGeoJSON());\n    } else {\n      this._edgesToGeoJSON().forEach((f) => geojson.features.push(f));\n    }\n\n    return geojson;\n  },\n\n  getState() {\n    const state = [\n      {\n        version: 2,\n        start: undefined,\n        metadata: undefined,\n      },\n    ];\n    let currentNode = this._getNode(this._firstNodeId);\n\n    if (currentNode !== undefined) {\n      state[0].start = encodeLatLng(currentNode.getLatLng());\n      state[0].metadata = JSON.parse(JSON.stringify(currentNode.options.metadata));\n    }\n\n    this._nodesContainers.forEach(() => {\n      const group = [];\n\n      do {\n        const { nextEdge, nextNode } = this._getNext(currentNode);\n        if (currentNode === undefined || nextEdge === undefined) {\n          break;\n        }\n\n        group.push({\n          end: encodeLatLng(nextNode.getLatLng()),\n          edge: encodeLatLngs(nextEdge.getLatLngs()),\n          metadata: {\n            node: JSON.parse(JSON.stringify(nextNode.options.metadata)),\n            edge: JSON.parse(JSON.stringify(nextEdge.options.metadata)),\n          },\n        });\n\n        currentNode = nextNode;\n      } while (currentNode.options.type !== 'stopover');\n\n      if (group.length > 0) state.push(group);\n    });\n\n    return state;\n  },\n\n  _fireStart(payload = {}) {\n    if (this._fireEvents && this._computing === 0) this.fire('TrackDrawer:start', payload);\n    this._computing += 1;\n  },\n\n  _fireDone(payload = {}) {\n    this._computing -= 1;\n    // TODO: find a way to store states while computing\n    if (this._fireEvents && this._computing === 0) this._pushState();\n    if (this._fireEvents && this._computing === 0) this.fire('TrackDrawer:done', payload);\n  },\n\n  _fireFailed(error) {\n    this._computing -= 1;\n    if (this._fireEvents && this._computing === 0) this.fire('TrackDrawer:failed', { message: error.message });\n  },\n\n  async refreshEdges(routingCallback) {\n    const callback = routingCallback || this.options.routingCallback;\n\n    this._fireStart();\n    const oldValue = this._fireEvents;\n    this._fireEvents = false;\n\n    const promises = [];\n    this._nodesContainers.forEach((container) => {\n      const markers = container.getLayers();\n      markers.forEach((marker) => {\n        promises.push(this.onMoveNode(marker, callback));\n      });\n    });\n\n    await Promise.all(promises);\n\n    this._fireEvents = oldValue;\n    this._fireDone();\n    return this;\n  },\n\n  clean() {\n    this._fireStart();\n    this._edgesContainers.clean();\n    this._nodesContainers.clean();\n\n    this._firstNodeId = undefined;\n    this._lastNodeId = undefined;\n    this._currentColorIndex = 0;\n\n    this._fireDone();\n    return this;\n  },\n\n  _createNode(latlng, metadata = {}) {\n    return L.TrackDrawer.node(latlng, { metadata });\n  },\n\n  async restoreState(state, nodeCallback) {\n    const callback = nodeCallback || this._createNode;\n    this._fireStart();\n\n    const oldValue = this._fireEvents;\n    this._fireEvents = false;\n    this.clean();\n\n    const stopovers = [];\n    const routes = [];\n    const promises = [];\n\n    let version;\n\n    state.forEach((group, i) => {\n      if (i === 0) {\n        // eslint-disable-next-line prefer-destructuring\n        version = group.version;\n        if (group.start) {\n          const marker = callback.call(null, decodeLatLng(group.start), version >= 2 ? group.metadata : {});\n          promises.push(\n            this.addNode(\n              marker,\n              () => {\n                throw new Error('Should not be called');\n              },\n              true,\n            ),\n          );\n        }\n        return;\n      }\n\n      group.forEach((segment, j) => {\n        const marker = callback.call(null, decodeLatLng(segment.end), version >= 2 ? segment.metadata.node : {});\n        if (j === group.length - 1 && i < state.length - 1) {\n          stopovers.push(marker);\n        }\n\n        promises.push(\n          this.addNode(\n            marker,\n            (from, to, done) => {\n              const edge = decodeLatLngs(segment.edge);\n              routes.push({ from, to, edge });\n              done(null, edge, version >= 2 ? segment.metadata.edge : {});\n            },\n            true,\n          ),\n        );\n      });\n    });\n\n    await Promise.all(promises);\n\n    stopovers.forEach((m) => this.promoteNodeToStopover(m));\n\n    this._fireEvents = oldValue;\n    this._fireDone({ routes });\n    return this;\n  },\n\n  _pushState() {\n    if (this.options.undoable && !this._undoing) {\n      if (this._currentStateIndex + 1 !== this._states.length) {\n        this._states.splice(this._currentStateIndex + 1);\n      }\n      this._currentStateIndex += 1;\n      this._states.push(this.getState());\n\n      if (this._states.length - 1 > this.options.undoDepth) {\n        this._states.splice(0, 1);\n        this._currentStateIndex -= 1;\n      }\n    }\n  },\n\n  async undo(nodeCallback) {\n    if (this.isUndoable() && this._computing === 0) {\n      this._currentStateIndex -= 1;\n      this._undoing = true;\n      await this.restoreState(this._states[this._currentStateIndex], nodeCallback);\n      this._undoing = false;\n      return true;\n    }\n    return false;\n  },\n\n  isUndoable() {\n    return this.options.undoable && this._currentStateIndex > 0;\n  },\n\n  isRedoable() {\n    return this.options.undoable && this._currentStateIndex < this._states.length - 1;\n  },\n\n  async redo(nodeCallback) {\n    if (this.isRedoable() && this._computing === 0) {\n      this._currentStateIndex += 1;\n      this._undoing = true;\n      await this.restoreState(this._states[this._currentStateIndex], nodeCallback);\n      this._undoing = false;\n      return true;\n    }\n    return false;\n  },\n\n  addLayer(layer) {\n    if (layer instanceof L.Marker) {\n      this.addNode(layer);\n    } else {\n      L.LayerGroup.prototype.addLayer.call(this, layer);\n    }\n  },\n\n  _createEdge(previousNode, node, metadata = {}) {\n    const edgesContainer = this._edgesContainers.get(this._getNodeContainerIndex(previousNode));\n    const edge = new Edge([previousNode.getLatLng(), node.getLatLng()], {\n      color: Colors.nameToRgb(previousNode.options.colorName),\n      dashArray: '4',\n      metadata,\n    }).addTo(edgesContainer);\n    const id = edgesContainer.getLayerId(edge);\n\n    previousNode._routeIdNext = id;\n    node._routeIdPrevious = id;\n    edge._startMarkerId = this._getNodeId(previousNode);\n    edge._endMarkerId = this._getNodeId(node);\n    edge._computation = 0;\n\n    if (this.options.debug) {\n      edge.on('tooltipopen', () => {\n        const startNodeId = edge._startMarkerId;\n        const endNodeId = edge._endMarkerId;\n\n        edge.setTooltipContent(\n          `id: ${this._getEdgeId(edge)} (on #${this._getEdgeContainerIndex(edge)})<br>`\n          + `previous node: ${startNodeId}`\n          + ` (on #${this._getNodeContainerIndex(this._getNode(startNodeId))})<br>`\n          + `next node: ${endNodeId}`\n          + ` (on #${this._getNodeContainerIndex(this._getNode(endNodeId))})`,\n        );\n      });\n      edge.bindTooltip('<>');\n    }\n\n    return edge;\n  },\n\n  _prepareNode(node, nodesContainer) {\n    if (this.options.debug) {\n      node.on('tooltipopen', () => {\n        const { previousEdge, previousNode } = this._getPrevious(node);\n        const { nextEdge, nextNode } = this._getNext(node);\n\n        node.setTooltipContent(\n          `id: ${this._getNodeId(node)} (on #${this._getNodeContainerIndex(node)})<br>`\n          + `previous edge: ${this._getEdgeId(previousEdge)}`\n          + ` (on #${this._getEdgeContainerIndex(previousEdge)}) to ${this._getNodeId(previousNode)}<br>`\n          + `next edge: ${this._getEdgeId(nextEdge)}`\n          + ` (on #${this._getEdgeContainerIndex(nextEdge)}) to ${this._getNodeId(nextNode)}`,\n        );\n      });\n      node.bindTooltip('<>');\n    }\n\n    if (nodesContainer.getLayers().length > 0) {\n      const previousNode = nodesContainer.getLayers()[0];\n      node.setStyle({ colorName: previousNode.options.colorName });\n    } else {\n      node.setStyle({ colorName: Colors.nameOf(this._currentColorIndex) });\n    }\n\n    if (node.options.draggable) {\n      node.on('dragstart', (e) => this._onDragStartNode(e.target));\n      node.on('drag', (e) => this._onDragNode(e.target));\n      node.on('moveend', (e) => this.onMoveNode(e.target));\n    }\n\n    node.addTo(nodesContainer);\n\n    return this;\n  },\n\n  addNode(node, routingCallback, skipChecks = false) {\n    const callback = routingCallback || this.options.routingCallback;\n\n    if (this._lastNodeId !== undefined && !skipChecks) {\n      const previousNode = this._getNode(this._lastNodeId);\n      if (previousNode.getLatLng().equals(node.getLatLng())) {\n        return new Promise((resolve) => {\n          resolve();\n        });\n      }\n    }\n\n    this._fireStart();\n\n    const nodesContainer = this._nodesContainers.get(-1);\n    this._prepareNode(node, nodesContainer);\n\n    if (this._lastNodeId !== undefined) {\n      const previousNode = this._getNode(this._lastNodeId);\n      this._createEdge(previousNode, node);\n    }\n\n    const lastNodeId = this._lastNodeId;\n    this._lastNodeId = this._getNodeId(node);\n    if (this._firstNodeId === undefined) {\n      this._firstNodeId = this._lastNodeId;\n    }\n\n    const oldValue = this._fireEvents;\n    this._fireEvents = false;\n    if (node.options.type === 'stopover') {\n      this.promoteNodeToStopover(node);\n    }\n    this._fireEvents = oldValue;\n\n    if (lastNodeId === undefined) {\n      return new Promise((resolve) => {\n        resolve();\n      }).then(() => {\n        this._fireDone({});\n      });\n    }\n\n    const { previousEdge, previousNode } = this._getPrevious(node);\n    previousEdge._computation += 1;\n    const currentComputation = previousEdge._computation;\n\n    return new Promise((resolve, reject) => {\n      callback.call(null, previousNode, node, (err, route, metadata = {}) => {\n        if (err !== null) {\n          reject(err);\n          return;\n        }\n\n        if (previousEdge._computation === currentComputation) {\n          // Route can give different precision than initial markers\n          // Use precision given by the route to be consistent\n          previousNode.setLatLng(L.latLng(route[0]));\n          node.setLatLng(L.latLng(route[route.length - 1]));\n          previousEdge.setLatLngs(route);\n          previousEdge.options.metadata = JSON.parse(JSON.stringify(metadata));\n          previousEdge.setStyle({ dashArray: null });\n        }\n\n        resolve({ routes: [{ from: previousNode, to: node, previousEdge }] });\n      });\n    })\n      .then((routes) => {\n        this._fireDone({ routes });\n      })\n      .catch((e) => {\n        this._fireFailed(e);\n      });\n  },\n\n  insertNode(node, route, routingCallback) {\n    const callback = routingCallback || this.options.routingCallback;\n\n    const startMarker = this._getNode(route._startMarkerId);\n    const endMarker = this._getNode(route._endMarkerId);\n\n    route.removeFrom(this._getEdgeContainer(route));\n    this._prepareNode(node, this._getNodeContainer(startMarker));\n\n    const edge1 = this._createEdge(startMarker, node);\n    const edge2 = this._createEdge(node, endMarker);\n\n    this._fireStart();\n\n    edge1._computation += 1;\n    edge2._computation += 1;\n    const currentComputation1 = edge1._computation;\n    const currentComputation2 = edge2._computation;\n\n    const promise1 = new Promise((resolve, reject) => {\n      callback.call(null, startMarker, node, (err, route1, metadata1 = {}) => {\n        if (err !== null) {\n          reject(err);\n          return;\n        }\n\n        if (edge1._computation === currentComputation1) {\n          startMarker.setLatLng(L.latLng(route1[0]));\n          node.setLatLng(L.latLng(route1[route1.length - 1]));\n          edge1.setLatLngs(route1);\n          edge1.options.metadata = JSON.parse(JSON.stringify(metadata1));\n          edge1.setStyle({ dashArray: null });\n        }\n        resolve({ from: startMarker, to: node, edge: edge1 });\n      });\n    });\n\n    const promise2 = new Promise((resolve, reject) => {\n      callback.call(null, node, endMarker, (err, route2, metadata2 = {}) => {\n        if (err !== null) {\n          reject(err);\n          return;\n        }\n\n        if (edge2._computation === currentComputation2) {\n          node.setLatLng(L.latLng(route2[0]));\n          endMarker.setLatLng(L.latLng(route2[route2.length - 1]));\n          edge2.setLatLngs(route2);\n          edge2.options.metadata = JSON.parse(JSON.stringify(metadata2));\n          edge2.setStyle({ dashArray: null });\n        }\n        resolve({ from: node, to: endMarker, edge: edge2 });\n      });\n    });\n\n    return Promise.all([promise1, promise2])\n      .then((routes) => {\n        this._fireDone({ routes });\n      })\n      .catch((e) => {\n        this._fireFailed(e);\n      });\n  },\n\n  _onDragStartNode(marker) {\n    const { previousEdge } = this._getPrevious(marker);\n    const { nextEdge } = this._getNext(marker);\n    if (previousEdge !== undefined) {\n      previousEdge.setStyle({ dashArray: '4' });\n    }\n    if (nextEdge !== undefined) {\n      nextEdge.setStyle({ dashArray: '4' });\n    }\n    return this;\n  },\n\n  _onDragNode(marker) {\n    const { previousEdge, previousNode } = this._getPrevious(marker);\n    const { nextEdge, nextNode } = this._getNext(marker);\n    if (previousEdge !== undefined) {\n      previousEdge.setLatLngs([previousNode.getLatLng(), marker.getLatLng()]);\n    }\n    if (nextEdge !== undefined) {\n      nextEdge.setLatLngs([nextNode.getLatLng(), marker.getLatLng()]);\n    }\n    return this;\n  },\n\n  onMoveNode(marker, routingCallback) {\n    const callback = routingCallback || this.options.routingCallback;\n\n    const promises = [];\n    const { previousEdge, previousNode } = this._getPrevious(marker);\n    const { nextEdge, nextNode } = this._getNext(marker);\n\n    this._fireStart();\n    this._onDragStartNode(marker);\n    this._onDragNode(marker);\n\n    if (previousEdge !== undefined) {\n      previousEdge._computation += 1;\n      const currentComputation = previousEdge._computation;\n\n      promises.push(\n        new Promise((resolve, reject) => {\n          callback.call(null, previousNode, marker, (err, route, metadata = {}) => {\n            if (err !== null) {\n              reject(err);\n              return;\n            }\n\n            if (previousEdge._computation === currentComputation) {\n              marker.setLatLng(L.latLng(route[route.length - 1]));\n              previousEdge.setLatLngs(route);\n              previousEdge.options.metadata = JSON.parse(JSON.stringify(metadata));\n              previousEdge.setStyle({ dashArray: null });\n            }\n\n            resolve({ from: previousNode, to: marker, edge: previousEdge });\n          });\n        }),\n      );\n    }\n\n    if (nextEdge !== undefined) {\n      nextEdge._computation += 1;\n      const currentComputation = nextEdge._computation;\n\n      promises.push(\n        new Promise((resolve, reject) => {\n          callback.call(null, marker, nextNode, (err, route, metadata = {}) => {\n            if (err !== null) {\n              reject(err);\n              return;\n            }\n\n            if (nextEdge._computation === currentComputation) {\n              marker.setLatLng(L.latLng(route[0]));\n              nextEdge.setLatLngs(route);\n              nextEdge.options.metadata = JSON.parse(JSON.stringify(metadata));\n              nextEdge.setStyle({ dashArray: null });\n            }\n\n            resolve({ from: marker, to: nextNode, edge: nextEdge });\n          });\n        }),\n      );\n    }\n\n    return Promise.all(promises)\n      .then((routes) => {\n        this._fireDone({ routes });\n      })\n      .catch((e) => {\n        this._fireFailed(e);\n      });\n  },\n\n  removeNode(node, routingCallback) {\n    const callback = routingCallback || this.options.routingCallback;\n\n    const promises = [];\n\n    this._fireStart();\n\n    const oldValue = this._fireEvents;\n    this._fireEvents = false;\n    this.demoteNodeToWaypoint(node);\n    this._fireEvents = oldValue;\n\n    const nodeContainer = this._getNodeContainer(node);\n\n    const { previousEdge, previousNode } = this._getPrevious(node);\n    const { nextEdge, nextNode } = this._getNext(node);\n\n    if (previousEdge !== undefined && nextEdge !== undefined) {\n      // Intermediate marker\n      nextNode._routeIdPrevious = node._routeIdPrevious;\n      previousEdge._endMarkerId = nextEdge._endMarkerId;\n\n      nextEdge.removeFrom(this._getEdgeContainer(nextEdge));\n      node.removeFrom(nodeContainer);\n      previousEdge.setLatLngs([previousNode.getLatLng(), nextNode.getLatLng()]).setStyle({ dashArray: '4' });\n\n      previousEdge._computation += 1;\n      const currentComputation = previousEdge._computation;\n\n      promises.push(\n        new Promise((resolve, reject) => {\n          callback.call(null, previousNode, nextNode, (err, route, metadata = {}) => {\n            if (err !== null) {\n              reject(err);\n              return;\n            }\n\n            if (previousEdge._computation === currentComputation) {\n              previousEdge.setLatLngs(route).setStyle({ dashArray: null });\n              previousEdge.options.metadata = JSON.parse(JSON.stringify(metadata));\n            }\n\n            resolve({ from: previousNode, to: nextNode, edge: previousEdge });\n          });\n        }),\n      );\n    } else if (previousEdge !== undefined) {\n      // Last marker of path\n      previousNode._routeIdNext = undefined;\n      this._lastNodeId = previousEdge._startMarkerId;\n      previousEdge.removeFrom(this._getEdgeContainer(previousEdge));\n      node.removeFrom(nodeContainer);\n    } else if (nextEdge !== undefined) {\n      // First marker of path\n      nextNode._routeIdPrevious = undefined;\n      this._firstNodeId = nextEdge._endMarkerId;\n      nextEdge.removeFrom(this._getEdgeContainer(nextEdge));\n      node.removeFrom(nodeContainer);\n    } else {\n      // Lonely marker\n      this._lastNodeId = undefined;\n      this._firstNodeId = undefined;\n      node.removeFrom(nodeContainer);\n    }\n\n    return Promise.all(promises)\n      .then((routes) => {\n        this._fireDone({ routes });\n      })\n      .catch((e) => {\n        this._fireFailed(e);\n      });\n  },\n\n  promoteNodeToStopover(node) {\n    if (node._promoted) {\n      return this;\n    }\n\n    if (this._getNodeId(node) === this._firstNodeId) {\n      node.setType('stopover');\n      node._promoted = true;\n      node._demoted = false;\n      return this;\n    }\n\n    this._fireStart();\n\n    const index = this._getNodeContainerIndex(node);\n\n    const nodes = [];\n    const edges = [];\n\n    let currentNode = node;\n    do {\n      nodes.push(currentNode);\n      const { nextEdge, nextNode } = this._getNext(currentNode);\n      if (nextEdge === undefined) {\n        break;\n      }\n\n      nodes.push(currentNode);\n      edges.push(nextEdge);\n\n      currentNode = nextNode;\n    } while (currentNode.options.type !== 'stopover');\n\n    const newNodesContainer = L.featureGroup();\n    const newEdgesContainer = L.featureGroup();\n\n    this._nodesContainers.splice(index + 1, 0, newNodesContainer);\n    this._edgesContainers.splice(index + 1, 0, newEdgesContainer);\n    this._currentColorIndex += 1;\n\n    nodes.forEach((e) => {\n      e.removeFrom(this._getNodeContainer(e)).addTo(newNodesContainer);\n    });\n    edges.forEach((e) => {\n      e.removeFrom(this._getEdgeContainer(e)).addTo(newEdgesContainer);\n    });\n\n    newNodesContainer.setStyle({ colorName: Colors.nameOf(this._currentColorIndex) });\n    newEdgesContainer.setStyle({ color: Colors.rgbOf(this._currentColorIndex) });\n\n    node.setType('stopover');\n    node._promoted = true;\n    node._demoted = false;\n\n    this._fireDone();\n    return this;\n  },\n\n  demoteNodeToWaypoint(node) {\n    if (node._demoted) {\n      return this;\n    }\n\n    const index = this._getNodeContainerIndex(node);\n    if (index === 0) {\n      return this;\n    }\n\n    this._fireStart();\n\n    const nodes = [];\n    const edges = [];\n\n    let currentNode = node;\n    do {\n      nodes.push(currentNode);\n      const { nextEdge, nextNode } = this._getNext(currentNode);\n      if (nextEdge === undefined) {\n        break;\n      }\n\n      nodes.push(currentNode);\n      edges.push(nextEdge);\n\n      currentNode = nextNode;\n    } while (currentNode.options.type !== 'stopover');\n\n    const previousNodesContainer = this._nodesContainers.get(index - 1);\n    const previousEdgesContainer = this._edgesContainers.get(index - 1);\n\n    this._nodesContainers.splice(index, 1);\n    this._edgesContainers.splice(index, 1);\n\n    nodes.forEach((e) => {\n      e.removeFrom(this._getNodeContainer(e)).addTo(previousNodesContainer);\n    });\n    edges.forEach((e) => {\n      e.removeFrom(this._getEdgeContainer(e)).addTo(previousEdgesContainer);\n    });\n\n    const { previousEdge, previousNode } = this._getPrevious(nodes[0]);\n    if (previousEdge !== undefined) {\n      previousNodesContainer.setStyle({ colorName: previousNode.options.colorName });\n      previousEdgesContainer.setStyle({ color: previousEdge.options.color });\n    }\n\n    node.setType('waypoint');\n    node._promoted = false;\n    node._demoted = true;\n\n    this._fireDone();\n    return this;\n  },\n});\n\nmodule.exports = {\n  Track,\n  track(options) {\n    return new Track(options);\n  },\n};\n","const L = require('leaflet');\n\nif (L.Control.EasyBar === undefined) {\n  module.exports = {\n    ToolBar: undefined,\n    toolBar: undefined,\n  };\n} else {\n  const ToolBar = L.Control.EasyBar.extend({\n    options: {\n      mode: null,\n      labelAddMarker: 'Add marker on click',\n      labelInsertMarker: 'Insert marker when clicking on track',\n      labelCloseLoop: 'Close the loop',\n      labelDeleteMarker: 'Delete marker on click',\n      labelPromoteMarker: 'Promote to stopover on click',\n      labelDemoteMarker: 'Demote to waypoint on click',\n      labelClean: 'Remove everything now',\n      labelUndo: 'Undo',\n      labelRedo: 'Redo',\n    },\n\n    initialize(track, options) {\n      this._track = track;\n\n      L.Util.setOptions(this, options);\n      L.Control.EasyBar.prototype.initialize.call(this, this._initializeButtons(), options);\n      this.setMode(this.options.mode);\n\n      this._track.getStepsContainer().on('click', (e) => {\n        if (this.options.mode === 'insert') {\n          const marker = L.TrackDrawer.node(e.latlng);\n          const route = e.layer;\n\n          route.setStyle({ weight: 3 });\n          this._track.insertNode(marker, route);\n          this._bindMarkerEvents(marker);\n        }\n      });\n\n      this._track.getStepsContainer().on('mouseover', (e) => {\n        if (this.options.mode === 'insert') {\n          e.layer.setStyle({ weight: 5 });\n        }\n      });\n\n      this._track.getStepsContainer().on('mouseout', (e) => {\n        if (this.options.mode === 'insert') {\n          e.layer.setStyle({ weight: 3 });\n        }\n      });\n\n      this._track._toolbar = this;\n      this._track._bindMarkerEvents = (marker) => {\n        this._bindMarkerEvents(marker);\n      };\n    },\n\n    setMode(m) {\n      this.options.mode = m;\n      this._addBtn.state('loaded');\n      this._insertBtn.state('loaded');\n      this._deleteBtn.state('loaded');\n      this._promoteBtn.state('loaded');\n      this._demoteBtn.state('loaded');\n\n      if (this._map) {\n        this._map.getContainer().style.cursor = '';\n      }\n\n      switch (this.options.mode) {\n        case 'add': {\n          this._addBtn.state('active');\n          if (this._map) {\n            this._map.getContainer().style.cursor = 'pointer';\n          }\n          break;\n        }\n        case 'insert': {\n          this._insertBtn.state('active');\n          break;\n        }\n        case 'delete': {\n          this._deleteBtn.state('active');\n          break;\n        }\n        case 'promote': {\n          this._promoteBtn.state('active');\n          break;\n        }\n        case 'demote': {\n          this._demoteBtn.state('active');\n          break;\n        }\n        default:\n        // Do nothing\n      }\n\n      return this;\n    },\n\n    _initializeButtons() {\n      const buttons = [];\n      this._addBtn = L.easyButton({\n        id: 'trackdrawer-add',\n        states: [\n          {\n            stateName: 'loaded',\n            icon: 'fa-plus',\n            title: this.options.labelAddMarker,\n            onClick: () => {\n              this.setMode('add');\n            },\n          },\n          {\n            stateName: 'active',\n            icon: 'fa-plus',\n            title: this.options.labelAddMarker,\n            onClick: () => {\n              this.setMode(null);\n            },\n          },\n        ],\n      });\n      buttons.push(this._addBtn);\n      this._insertBtn = L.easyButton({\n        id: 'trackdrawer-insert',\n        states: [\n          {\n            stateName: 'loaded',\n            icon: 'fa-plus-circle',\n            title: this.options.labelInsertMarker,\n            onClick: () => {\n              this.setMode('insert');\n            },\n          },\n          {\n            stateName: 'active',\n            icon: 'fa-plus-circle',\n            title: this.options.labelInsertMarker,\n            onClick: () => {\n              this.setMode(null);\n            },\n          },\n        ],\n      });\n      buttons.push(this._insertBtn);\n      this._closeLoop = L.easyButton({\n        id: 'trackdrawer-closeloop',\n        states: [\n          {\n            stateName: 'loaded',\n            icon: 'fa-magic',\n            title: this.options.labelCloseLoop,\n            onClick: () => {\n              if (this._track.hasNodes(2)) {\n                const nodes = this._track.getNodes();\n                const marker = L.TrackDrawer.node(nodes[0].markers[0].getLatLng()).addTo(this._track);\n                this._bindMarkerEvents(marker);\n              }\n            },\n          },\n        ],\n      });\n      buttons.push(this._closeLoop);\n      this._deleteBtn = L.easyButton({\n        id: 'trackdrawer-delete',\n        states: [\n          {\n            stateName: 'loaded',\n            icon: 'fa-eraser',\n            title: this.options.labelDeleteMarker,\n            onClick: () => {\n              this.setMode('delete');\n            },\n          },\n          {\n            stateName: 'active',\n            icon: 'fa-eraser',\n            title: this.options.labelDeleteMarker,\n            onClick: () => {\n              this.setMode(null);\n            },\n          },\n        ],\n      });\n      buttons.push(this._deleteBtn);\n      this._promoteBtn = L.easyButton({\n        id: 'trackdrawer-promote',\n        states: [\n          {\n            stateName: 'loaded',\n            icon: 'fa-pause-circle',\n            title: this.options.labelPromoteMarker,\n            onClick: () => {\n              this.setMode('promote');\n            },\n          },\n          {\n            stateName: 'active',\n            icon: 'fa-pause-circle',\n            title: this.options.labelPromoteMarker,\n            onClick: () => {\n              this.setMode(null);\n            },\n          },\n        ],\n      });\n      buttons.push(this._promoteBtn);\n      this._demoteBtn = L.easyButton({\n        id: 'trackdrawer-demote',\n        states: [\n          {\n            stateName: 'loaded',\n            icon: 'fa-map-signs',\n            title: this.options.labelDemoteMarker,\n            onClick: () => {\n              this.setMode('demote');\n            },\n          },\n          {\n            stateName: 'active',\n            icon: 'fa-map-signs',\n            title: this.options.labelDemoteMarker,\n            onClick: () => {\n              this.setMode(null);\n            },\n          },\n        ],\n      });\n      buttons.push(this._demoteBtn);\n      this._cleanBtn = L.easyButton({\n        id: 'trackdrawer-clean',\n        states: [\n          {\n            icon: 'fa-trash',\n            title: this.options.labelClean,\n            onClick: () => {\n              this._track.clean();\n            },\n          },\n        ],\n      });\n      buttons.push(this._cleanBtn);\n\n      if (this._track.options.undoable) {\n        this._undoBtn = L.easyButton({\n          id: 'trackdrawer-undo',\n          states: [\n            {\n              icon: 'fa-undo',\n              title: this.options.labelUndo,\n              onClick: () => {\n                this._track.undo((latlng) => {\n                  const marker = L.TrackDrawer.node(latlng);\n                  this._bindMarkerEvents(marker);\n                  return marker;\n                });\n              },\n            },\n          ],\n        });\n        buttons.push(this._undoBtn);\n        this._redoBtn = L.easyButton({\n          id: 'trackdrawer-redo',\n          states: [\n            {\n              icon: 'fa-repeat',\n              title: this.options.labelRedo,\n              onClick: () => {\n                this._track.redo((latlng) => {\n                  const marker = L.TrackDrawer.node(latlng);\n                  this._bindMarkerEvents(marker);\n                  return marker;\n                });\n              },\n            },\n          ],\n        });\n        buttons.push(this._redoBtn);\n      }\n\n      this._track.on('TrackDrawer:start', () => {\n        if (this._track.options.undoable) {\n          this._undoBtn.disable();\n          this._redoBtn.disable();\n        }\n      });\n\n      this._track.on('TrackDrawer:done', () => {\n        if (this._track.hasNodes(2)) {\n          this._closeLoop.enable();\n        } else {\n          this._closeLoop.disable();\n        }\n\n        if (this._track.hasNodes()) {\n          this._insertBtn.enable();\n          this._deleteBtn.enable();\n          this._promoteBtn.enable();\n          this._demoteBtn.enable();\n          this._cleanBtn.enable();\n        } else {\n          this._insertBtn.disable();\n          this._deleteBtn.disable();\n          this._promoteBtn.disable();\n          this._demoteBtn.disable();\n          this._cleanBtn.disable();\n        }\n\n        if (this._track.options.undoable) {\n          if (this._track.isUndoable()) {\n            this._undoBtn.enable();\n          } else {\n            this._undoBtn.disable();\n          }\n          if (this._track.isRedoable()) {\n            this._redoBtn.enable();\n          } else {\n            this._redoBtn.disable();\n          }\n        }\n      });\n\n      return buttons;\n    },\n\n    _bindMarkerEvents(marker) {\n      marker.on('click', this._onMarkerClickHandler);\n      marker.on('mouseover', this._onMarkerMouseOverHandler);\n      marker.on('mouseout', this._onMarkerMouseOutHandler);\n      return this;\n    },\n\n    onAdd(map) {\n      this._onMapClickHandler = (e) => {\n        if (this.options.mode === 'add') {\n          const marker = L.TrackDrawer.node(e.latlng).addTo(this._track);\n          this._bindMarkerEvents(marker);\n        }\n      };\n\n      this._onMarkerClickHandler = (e) => {\n        const marker = e.target;\n        switch (this.options.mode) {\n          case 'delete': {\n            const { previousEdge } = this._track._getPrevious(marker);\n            const { nextEdge } = this._track._getNext(marker);\n\n            if (previousEdge) previousEdge.setStyle({ weight: 3 });\n            if (nextEdge) nextEdge.setStyle({ weight: 3 });\n\n            this._track.removeNode(marker);\n            break;\n          }\n          case 'promote': {\n            this._track.promoteNodeToStopover(marker);\n            break;\n          }\n          case 'demote': {\n            this._track.demoteNodeToWaypoint(marker);\n            break;\n          }\n          default:\n        }\n      };\n\n      this._onMarkerMouseOverHandler = (e) => {\n        if (this.options.mode === 'delete' || this.options.mode === 'promote' || this.options.mode === 'demote') {\n          const marker = e.target;\n          const { previousEdge } = this._track._getPrevious(marker);\n          const { nextEdge } = this._track._getNext(marker);\n\n          if (previousEdge) previousEdge.setStyle({ weight: 5 });\n          if (nextEdge) nextEdge.setStyle({ weight: 5 });\n        }\n      };\n\n      this._onMarkerMouseOutHandler = (e) => {\n        const marker = e.target;\n        const { previousEdge } = this._track._getPrevious(marker);\n        const { nextEdge } = this._track._getNext(marker);\n\n        if (previousEdge) previousEdge.setStyle({ weight: 3 });\n        if (nextEdge) nextEdge.setStyle({ weight: 3 });\n      };\n\n      L.DomEvent.on(map, 'click', this._onMapClickHandler);\n      return L.Control.EasyBar.prototype.onAdd.call(this, map);\n    },\n\n    onRemove(map) {\n      if (this.options.mode === 'add') map.getContainer().style.cursor = '';\n\n      L.DomEvent.off(map, 'click', this._onMapClickHandler);\n      this._track.getNodes().forEach((nodes) => {\n        nodes.markers.forEach((marker) => {\n          marker.off('click', this._onMarkerClickHandler);\n          marker.off('mouseover', this._onMarkerMouseOverHandler);\n          marker.off('mouseout', this._onMarkerMouseOutHandler);\n        });\n      });\n    },\n  });\n\n  module.exports = {\n    ToolBar,\n    toolBar(track, options) {\n      return new ToolBar(track, options);\n    },\n  };\n}\n","const L = require('leaflet');\n\nif (L.Control.EasyBar === undefined) {\n  module.exports = {\n    TraceModeBar: undefined,\n    traceModeBar: undefined,\n  };\n} else {\n  const TraceModeBar = L.Control.EasyBar.extend({\n    options: {\n      mode: null,\n    },\n\n    initialize(track, modes, options) {\n      this._track = track;\n      this._buttonsMap = {};\n\n      L.Control.EasyBar.prototype.initialize.call(this, this._initializeButtons(modes), options);\n      this.setMode(this.options.mode);\n    },\n\n    setMode(m) {\n      const ids = Object.keys(this._buttonsMap);\n      let newMode = m;\n      if (newMode === null) {\n        const idx = this.options.mode === ids[0] ? 1 : 0;\n        newMode = ids[idx];\n      }\n\n      this.options.mode = newMode;\n      ids.forEach((key) => {\n        this._buttonsMap[key].btn.state('loaded');\n      });\n\n      this._buttonsMap[newMode].btn.state('active');\n      this._track.setOptions({\n        router: this._buttonsMap[newMode].router,\n        routingCallback: this._buttonsMap[newMode].routingCallback,\n      });\n\n      return this;\n    },\n\n    _initializeButtons(modes) {\n      const buttons = [];\n      modes.forEach((m) => {\n        const btn = L.easyButton({\n          id: `trackdrawer-mode-${m.id}`,\n          states: [\n            {\n              stateName: 'loaded',\n              icon: m.icon,\n              title: m.name,\n              onClick: () => {\n                this.setMode(m.id);\n              },\n            },\n            {\n              stateName: 'active',\n              icon: m.icon,\n              title: m.name,\n              onClick: () => {\n                this.setMode(null);\n              },\n            },\n          ],\n        });\n        buttons.push(btn);\n        this._buttonsMap[m.id] = {\n          router: m.router,\n          routingCallback: m.routingCallback,\n          btn,\n        };\n      });\n\n      return buttons;\n    },\n  });\n\n  module.exports = {\n    TraceModeBar,\n    traceModeBar(track, modes, options) {\n      return new TraceModeBar(track, modes, options);\n    },\n  };\n}\n","const L = require('leaflet');\n\nconst Node = L.Marker.extend({\n  _routeIdPrevious: undefined,\n  _routeIdNext: undefined,\n  _promoted: false,\n  _demoted: true,\n\n  options: {\n    type: 'waypoint', // Or 'stopover',\n    colorName: 'blue',\n    opacity: 1,\n    draggable: true,\n    metadata: {},\n  },\n\n  initialize(latlng, options) {\n    L.Marker.prototype.initialize.call(this, latlng, options);\n    L.setOptions(this, options);\n    this.setType(this.options.type);\n    this.options.metadata = JSON.parse(JSON.stringify(this.options.metadata));\n  },\n\n  setType(type) {\n    this.options.type = type;\n\n    if (type === 'stopover') {\n      this.setIcon(\n        L.AwesomeMarkers.icon({\n          icon: 'pause-circle',\n          markerColor: this.options.colorName,\n          prefix: 'fa',\n        }),\n      );\n    } else {\n      this.setIcon(\n        L.AwesomeMarkers.icon({\n          icon: 'map-signs',\n          markerColor: this.options.colorName,\n          prefix: 'fa',\n        }),\n      );\n    }\n    return this;\n  },\n\n  setStyle(style) {\n    L.Util.setOptions(this, style);\n\n    if ('colorName' in style) {\n      // Colors is set only via the icon and there's no setter on L.AwesomeMarkers\n      this.setType(this.options.type);\n    }\n    if ('opacity' in style) {\n      this.setOpacity(this.options.opacity);\n    }\n\n    return this;\n  },\n});\n\nmodule.exports = {\n  Node,\n  node(latlng, options) {\n    return new Node(latlng, options);\n  },\n};\n","const L = require('leaflet');\n\n/**\n * Splits an array of LatLng objects every X meters\n * @param {L.LatLng[]} latlngs Polyline to split\n * @param {int} distance Max. distance of each segment of the polyline (in meters)\n * @returns L.LatLng[][]\n */\nfunction splitLatLngs(latlngs, distance = 100) {\n  if (distance <= 0) throw new Error('`distance` must be positive');\n  if (latlngs.length === 0) return [[]];\n\n  let result = [];\n  if (Array.isArray(latlngs[0])) {\n    for (let j = 0; j < latlngs.length; j += 1) {\n      result = result.concat(splitLatLngs(latlngs[j], distance));\n    }\n\n    return result;\n  }\n\n  let tmp = latlngs.splice(0, 1);\n  while (latlngs.length > 0) {\n    const latlng = L.latLng(latlngs.splice(0, 1)[0]);\n    tmp.push(latlng);\n    if (latlng.distanceTo(tmp[0]) > distance) {\n      result.push(tmp);\n      tmp = [latlng];\n    }\n  }\n  result.push(tmp);\n\n  return result;\n}\n\n/**\n * Splits a L.Polyline object every X meters\n * @param {L.Polyline} polyline Polyline to split\n * @param {int} distance Max. distance of each segment of the polyline (in meters)\n * @returns L.Polyline[]\n */\nfunction splitPolyline(polyline, distance = 100) {\n  return splitLatLngs(polyline.getLatLngs(), distance).map((a) => L.polyline(a));\n}\n\nfunction featureGroupToPolylines(featureGroup) {\n  return featureGroup.getLayers().filter((layer) => layer instanceof L.Polyline);\n}\n\nfunction featureGroupToLatLngs(featureGroup) {\n  return featureGroupToPolylines(featureGroup).map((layer) => [layer.getLatLngs(), layer.feature.properties]);\n}\n\nmodule.exports = {\n  splitPolyline,\n  splitLatLngs,\n  featureGroupToPolylines,\n  featureGroupToLatLngs,\n};\n","/* eslint-disable arrow-parens */\nconst L = require('leaflet');\nconst corslite = require('@mapbox/corslite');\nconst { Track } = require('./Track');\nconst latlngutils = require('./LatLngUtils');\n\nTrack.include({\n  _createFileLoader() {\n    this._fileLoader = L.FileLayer.fileLoader(null, {\n      addToMap: false,\n      fileSizeLimit: this.options.fileSizeLimit || 1024,\n      formats: this.options.fileFormat || ['.geojson', '.json', '.kml', '.gpx'],\n    });\n  },\n\n  createFileLoaderControl(insertWaypoints = false) {\n    this._fileLoaderController = L.Control.fileLayerLoad({\n      addToMap: false,\n      fileSizeLimit: this.options.fileSizeLimit || 1024,\n      formats: this.options.fileFormat || ['.geojson', '.json', '.kml', '.gpx'],\n    }).addTo(this._map);\n\n    this._fileLoaderController.loader.on('data:loaded', (event) => {\n      this._dataLoadedHandler(event.layer, insertWaypoints);\n    });\n\n    return this._fileLoaderController;\n  },\n\n  async _dataLoadedHandler(layer, insertWaypoints = false) {\n    this._fireStart();\n\n    const oldValue = this._fireEvents;\n    this._fireEvents = false;\n    this.clean();\n\n    const latlngs = insertWaypoints\n      ? latlngutils.featureGroupToLatLngs(layer).map(l => [latlngutils.splitLatLngs(l[0]), l[1]])\n      : latlngutils.featureGroupToLatLngs(layer).map(l => [[l[0]], l[1]]);\n\n    let lastMarker;\n    const hasToolbar = this._toolbar !== undefined;\n    /* eslint-disable no-await-in-loop */\n    for (let i = 0; i < latlngs.length; i += 1) {\n      const properties = latlngs[i][1];\n      for (let j = 0; j < latlngs[i][0].length; j += 1) {\n        const l = latlngs[i][0][j];\n        if (l.length > 0) {\n          if (lastMarker === undefined) {\n            lastMarker = L.TrackDrawer.node(l[0]);\n            await this.addNode(lastMarker, undefined, true);\n            if (hasToolbar) this._bindMarkerEvents(lastMarker);\n          }\n\n          lastMarker = L.TrackDrawer.node(l[l.length - 1], {\n            type: j === latlngs[i][0].length - 1 ? 'stopover' : 'waypoint',\n          });\n          await this.addNode(\n            lastMarker,\n            (_n1, _n2, cb) => {\n              cb(null, l, properties);\n            },\n            true,\n          );\n          if (hasToolbar) this._bindMarkerEvents(lastMarker);\n        }\n      }\n    }\n    /* eslint-enable no-await-in-loop */\n\n    this._fireEvents = oldValue;\n    this._fireDone();\n  },\n\n  loadData(data, name, ext, insertWaypoints = false) {\n    return new Promise((resolve, reject) => {\n      this._fileLoader.on('data:loaded', async (event) => {\n        await this._dataLoadedHandler(event.layer, insertWaypoints);\n        this._fileLoader.off();\n        resolve();\n      });\n      this._fileLoader.on('data:error', (error) => {\n        this._fileLoader.off();\n        reject(error.error);\n      });\n\n      this._fileLoader.loadData(data, name, ext);\n    });\n  },\n\n  loadFile(file, insertWaypoints = false) {\n    return new Promise((resolve, reject) => {\n      this._fileLoader.on('data:loaded', async (event) => {\n        await this._dataLoadedHandler(event.layer, insertWaypoints);\n        this._fileLoader.off();\n        resolve();\n      });\n      this._fileLoader.on('data:error', (error) => {\n        this._fileLoader.off();\n        reject(error.error);\n      });\n\n      this._fileLoader.load(file);\n    });\n  },\n\n  loadUrl(url, useProxy = false, insertWaypoints = false) {\n    const filename = url.split('/').pop();\n    const ext = filename.split('.').pop();\n\n    const proxiedUrl = useProxy ? `fetch.php?url=${encodeURI(url)}` : url;\n\n    return new Promise((resolve, reject) => {\n      corslite(\n        proxiedUrl,\n        (err, resp) => {\n          if (!err) {\n            try {\n              this._fileLoader.on('data:loaded', async (event) => {\n                await this._dataLoadedHandler(event.layer, insertWaypoints);\n                this._fileLoader.off();\n                resolve();\n              });\n              this._fileLoader.on('data:error', (error) => {\n                this._fileLoader.off();\n                reject(error.error);\n              });\n              this._fileLoader.loadData(resp.responseText, filename, ext);\n            } catch (ex) {\n              reject(ex);\n            }\n          } else if (err.responseText) {\n            try {\n              // Check if response is JSON\n              const data = JSON.parse(err.responseText);\n              reject(new Error(data.error));\n            } catch (ex) {\n              reject(new Error(err.statusText));\n            }\n          } else if (err.statusText) {\n            reject(new Error(err.statusText));\n          } else {\n            reject(new Error(err));\n          }\n        },\n        false,\n      );\n    });\n  },\n});\n\nTrack.addInitHook('_createFileLoader');\n","const L = require('leaflet');\nconst { Track, track } = require('./Track');\nconst { ToolBar, toolBar } = require('./ToolBar');\nconst { TraceModeBar, traceModeBar } = require('./TraceModeBar');\nconst LayerContainer = require('./LayerContainer');\nconst { Node, node } = require('./Node');\nconst { Edge, edge } = require('./Edge');\nconst colors = require('./Colors');\nrequire('./Loader');\nconst latlngutils = require('./LatLngUtils');\n\n/** @module L.TrackDrawer */\nL.TrackDrawer = {\n  Track,\n  track,\n  ToolBar,\n  toolBar,\n  TraceModeBar,\n  traceModeBar,\n  LayerContainer,\n  Node,\n  node,\n  Edge,\n  edge,\n  colors,\n  latlngutils,\n};\n\nmodule.exports = L.TrackDrawer;\n"],"names":["colorMap","red","orange","green","blue","purple","darkred","darkblue","darkgreen","darkpurple","cadetblue","lightred","beige","lightgreen","lightblue","pink","white","lightgray","gray","black","colors","Object","freeze","nameOf","idx","length","rgbOf","nameToRgb","name","rgbToName","rgb","keys","find","key","L","Evented","extend","initialize","parent","_parent","f","featureGroup","addTo","addEventParent","_elements","get","i","splice","ret","arguments","forEach","x","removeFrom","removeEventParent","args","Array","prototype","slice","call","cb","clean","clearLayers","getLayer","id","parentLayer","undefined","getLayerId","layer","hasLayer","getLayerIndex","findIndex","Edge","Polyline","_startMarkerId","_endMarkerId","_promoted","_demoted","_computation","options","metadata","latlngs","setOptions","JSON","parse","stringify","edge","require$$0","encodeLatLngs","array","size","push","lat","lng","decodeLatLngs","latLng","encodeLatLng","latlng","decodeLatLng","Track","LayerGroup","routingCallback","router","debug","undoable","undoDepth","_getPrevious","node","previousEdge","_getEdge","_routeIdPrevious","previousNode","_getNode","_getNext","nextEdge","_routeIdNext","nextNode","_getNodeId","_nodesContainers","_getEdgeId","_edgesContainers","_getNodeContainerIndex","_getNodeContainer","_getEdgeContainerIndex","_getEdgeContainer","LayerContainer","_firstNodeId","_lastNodeId","_currentColorIndex","_fireEvents","_computing","_states","_currentStateIndex","getState","previousMarker","marker","done","route","Routing","waypoint","getLatLng","err","result","coordinates","hasNodes","count","counter","container","group","getLayers","getNodes","nodes","markers","getNodesContainer","getSteps","steps","edges","getStepsContainer","getBounds","bounds","latLngBounds","getLatLngs","hasTrackStats","TrackStats","currentNode","l","e","cache","getAll","type","_stopoversToGeoJSON","stopovers","features","properties","index","geometry","z","_edgesToFlatGeoJSON","feature","e2","_edgesToGeoJSON","_c","toGeoJSON","exportStopovers","exportAsFlat","geojson","state","version","start","end","_fireStart","payload","fire","_fireDone","_pushState","_fireFailed","error","message","refreshEdges","callback","oldValue","promises","onMoveNode","Promise","all","_createNode","TrackDrawer","restoreState","nodeCallback","routes","addNode","Error","segment","j","from","to","m","promoteNodeToStopover","_undoing","undo","isUndoable","isRedoable","redo","addLayer","Marker","_createEdge","edgesContainer","color","Colors","colorName","dashArray","on","startNodeId","endNodeId","setTooltipContent","bindTooltip","_prepareNode","nodesContainer","setStyle","draggable","_onDragStartNode","target","_onDragNode","skipChecks","equals","resolve","lastNodeId","then","currentComputation","reject","setLatLng","setLatLngs","insertNode","startMarker","endMarker","edge1","edge2","currentComputation1","currentComputation2","promise1","route1","metadata1","promise2","route2","metadata2","removeNode","demoteNodeToWaypoint","nodeContainer","setType","newNodesContainer","newEdgesContainer","previousNodesContainer","previousEdgesContainer","track","Control","EasyBar","module","ToolBar","toolBar","mode","labelAddMarker","labelInsertMarker","labelCloseLoop","labelDeleteMarker","labelPromoteMarker","labelDemoteMarker","labelClean","labelUndo","labelRedo","_track","Util","_initializeButtons","setMode","weight","_bindMarkerEvents","_toolbar","_addBtn","_insertBtn","_deleteBtn","_promoteBtn","_demoteBtn","_map","getContainer","style","cursor","buttons","easyButton","states","stateName","icon","title","onClick","_closeLoop","_cleanBtn","_undoBtn","_redoBtn","disable","enable","_onMarkerClickHandler","_onMarkerMouseOverHandler","_onMarkerMouseOutHandler","onAdd","map","_onMapClickHandler","DomEvent","onRemove","off","TraceModeBar","traceModeBar","modes","_buttonsMap","ids","newMode","btn","Node","opacity","setIcon","AwesomeMarkers","markerColor","prefix","setOpacity","splitLatLngs","distance","isArray","concat","tmp","distanceTo","splitPolyline","polyline","a","featureGroupToPolylines","filter","featureGroupToLatLngs","include","_createFileLoader","_fileLoader","FileLayer","fileLoader","addToMap","fileSizeLimit","formats","fileFormat","createFileLoaderControl","insertWaypoints","_fileLoaderController","fileLayerLoad","loader","event","_dataLoadedHandler","latlngutils","hasToolbar","lastMarker","_n1","_n2","loadData","data","ext","loadFile","file","load","loadUrl","url","useProxy","filename","split","pop","proxiedUrl","encodeURI","corslite","resp","responseText","ex","statusText","addInitHook","require$$1","require$$2","require$$3","require$$4"],"mappings":"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"}