!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("leaflet"),require("@mapbox/corslite")):"function"==typeof define&&define.amd?define(["leaflet","@mapbox/corslite"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).leaflet_trackdrawer=e(t.L,t.corslite)}(this,(function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(t),o=n(e);function i(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}var a=i((function(t){var e=function(t){var e,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function d(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(t){d=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof _?e:_,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r=c;return function(o,i){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===o)throw i;return M()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===c)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var d=l(t,e,n);if("normal"===d.type){if(r=n.done?p:f,d.arg===g)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(r=p,n.method="throw",n.arg=d.arg)}}}(t,n,a),i}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var c="suspendedStart",f="suspendedYield",h="executing",p="completed",g={};function _(){}function v(){}function m(){}var y={};y[i]=function(){return this};var k=Object.getPrototypeOf,N=k&&k(k(I([])));N&&N!==n&&r.call(N,i)&&(y=N);var L=m.prototype=_.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(o,i,a,s){var d=l(t[o],t,i);if("throw"!==d.type){var u=d.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?e.resolve(c.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(c).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(d.arg)}var o;this._invoke=function(t,r){function i(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(i,i):i()}}function E(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=l(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function I(t){if(t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:M}}function M(){return{value:e,done:!0}}return v.prototype=L.constructor=m,m.constructor=v,v.displayName=d(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,d(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},t.awrap=function(t){return{__await:t}},b(x.prototype),x.prototype[a]=function(){return this},t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(L),d(L,s,"Generator"),L[i]=function(){return this},L.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=I,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var d=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(d&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(d){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;C(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}}));function s(t,e,n,r,o,i,a){try{var s=t[i](a),d=s.value}catch(t){return void n(t)}s.done?e(d):Promise.resolve(d).then(r,o)}var d=function(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){s(i,r,o,a,d,"next",t)}function d(t){s(i,r,o,a,d,"throw",t)}a(void 0)}))}},u={red:"#D63E2A",orange:"#F59630",green:"#72B026",blue:"#38AADD",purple:"#D252B9",darkred:"#A23336",darkblue:"#0067A3",darkgreen:"#728224",darkpurple:"#5B396B",cadetblue:"#436978",lightred:"#FF8E7F",beige:"#FFCB92",lightgreen:"#BBF970",lightblue:"#8ADAFF",pink:"#FF91EA",white:"#FBFBFB",lightgray:"#A3A3A3",gray:"#575757",black:"#303030"},l=["blue","green","orange","purple","red","darkblue","darkpurple","lightblue","lightgreen","beige","pink","lightred"];Object.freeze(u),Object.freeze(l);var c={nameOf:function(t){return l[t%l.length]},rgbOf:function(t){return u[this.nameOf(t)]},nameToRgb:function(t){return u[t]},rgbToName:function(t){return Object.keys(u).find((function(e){return u[e]===t}))}},f=r.default.Evented.extend({initialize:function(t){this._parent=t;var e=r.default.featureGroup().addTo(t).addEventParent(this);this._elements=[e],this.length=1},get:function(t){var e=t<0?this._elements.length+t:t;return this._elements[e]},splice:function(){var t,e=this,n=(t=this._elements).splice.apply(t,arguments);if(n.forEach((function(t){return t.removeFrom(e._parent).removeEventParent(e)})),arguments.length>2){var r=Array.prototype.slice.call(arguments,2);r.forEach((function(t){t.addTo(e._parent).addEventParent(e)}))}return this.length=this._elements.length,n},forEach:function(t){this._elements.forEach(t)},clean:function(){this._elements[0].clearLayers(),this.splice(1)},getLayer:function(t){var e=this._elements.find((function(e){return void 0!==e.getLayer(t)}));return void 0!==e?e.getLayer(t):void 0},getLayerId:function(t){var e=this._elements.find((function(e){return e.hasLayer(t)}));return void 0!==e?e.getLayerId(t):void 0},getLayerIndex:function(t){return this._elements.findIndex((function(e){return e.hasLayer(t)}))}}),h=r.default.Polyline.extend({_startMarkerId:void 0,_endMarkerId:void 0,_promoted:!1,_demoted:!0,_computation:0,options:{metadata:{}},initialize:function(t,e){r.default.Polyline.prototype.initialize.call(this,t,e),r.default.setOptions(this,e),this.options.metadata=JSON.parse(JSON.stringify(this.options.metadata))}}),p={Edge:h,edge:function(t,e){return new h(t,e)}},g=p.Edge;function _(t){for(var e=[],n=t.length,r=0;r<n;r+=1)e.push(t[r].lat),e.push(t[r].lng);return e}function v(t){for(var e=[],n=t.length,o=0;o<n;o+=2)e.push(r.default.latLng(t[o],t[o+1]));return e}function m(t){return[t.lat,t.lng]}function y(t){return r.default.latLng(t[0],t[1])}var k=r.default.LayerGroup.extend({options:{routingCallback:void 0,router:void 0,debug:!1,undoable:!0,undoDepth:30},_getPrevious:function(t){var e=void 0!==t?this._getEdge(t._routeIdPrevious):void 0;return{previousEdge:e,previousNode:void 0!==e?this._getNode(e._startMarkerId):void 0}},_getNext:function(t){var e=void 0!==t?this._getEdge(t._routeIdNext):void 0;return{nextEdge:e,nextNode:void 0!==e?this._getNode(e._endMarkerId):void 0}},_getNodeId:function(t){return this._nodesContainers.getLayerId(t)},_getEdgeId:function(t){return this._edgesContainers.getLayerId(t)},_getNode:function(t){return this._nodesContainers.getLayer(t)},_getEdge:function(t){return this._edgesContainers.getLayer(t)},_getNodeContainerIndex:function(t){return this._nodesContainers.getLayerIndex(t)},_getNodeContainer:function(t){return this._nodesContainers.get(this._getNodeContainerIndex(t))},_getEdgeContainerIndex:function(t){return this._edgesContainers.getLayerIndex(t)},_getEdgeContainer:function(t){return this._edgesContainers.get(this._getEdgeContainerIndex(t))},initialize:function(t){this.setOptions(t),r.default.LayerGroup.prototype.initialize.call(this),this._nodesContainers=new f(this),this._edgesContainers=new f(this),this._firstNodeId=void 0,this._lastNodeId=void 0,this._currentColorIndex=0,this._fireEvents=!0,this._computing=0,this._states=null,this._currentStateIndex=null,this.options.undoable&&(this._states=[],this._states.push(this.getState()),this._currentStateIndex=0)},setOptions:function(t){var e=this;r.default.setOptions(this,t),void 0!==this.options.router&&(this.options.routingCallback=function(t,n,o){e.options.router.route([r.default.Routing.waypoint(t.getLatLng()),r.default.Routing.waypoint(n.getLatLng())],(function(t,e){o(t,e?e[0].coordinates:null,{})}))})},hasNodes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=0;return this._nodesContainers.forEach((function(t){var n=t.getLayers();e+=n.length})),e>=t},getNodes:function(){var t=[];return this._nodesContainers.forEach((function(e){var n=e.getLayers();n.length>0&&t.push({container:e,markers:n})})),t},getNodesContainer:function(){return this._nodesContainers},getSteps:function(){var t=[];return this._edgesContainers.forEach((function(e){var n=e.getLayers();n.length>0&&t.push({container:e,edges:n})})),t},getStepsContainer:function(){return this._edgesContainers},getBounds:function(){var t=r.default.latLngBounds([]);return this._nodesContainers.forEach((function(e){t.extend(e.getBounds())})),this._edgesContainers.forEach((function(e){t.extend(e.getBounds())})),t},getLatLngs:function(){var t=this,e=void 0!==r.default.TrackStats,n=[],o=this._getNode(this._firstNodeId);return this._nodesContainers.forEach((function(){var i=[];do{var a=t._getNext(o),s=a.nextEdge,d=a.nextNode;if(void 0===o||void 0===s)break;s.getLatLngs().forEach((function(t){i.push(e?r.default.TrackStats.cache.getAll(t):t)})),o=d}while("stopover"!==o.options.type);n.push(JSON.parse(JSON.stringify(i)))})),n},_stopoversToGeoJSON:function(){var t=this,e=[],n=[],o=this._getNode(this._firstNodeId);void 0!==o&&e.push(o),this._nodesContainers.forEach((function(){do{var n=t._getNext(o),r=n.nextEdge,i=n.nextNode;if(void 0===o||void 0===r)break;o=i}while("stopover"!==o.options.type);void 0!==o&&e.push(o)}));var i=void 0!==r.default.TrackStats;return e.forEach((function(t,e){var o=i?r.default.TrackStats.cache.getAll(t.getLatLng()):t.getLatLng(),a=JSON.parse(JSON.stringify(t.options.metadata));a.index=e,n.push({type:"Feature",properties:a,geometry:{type:"Point",coordinates:"z"in o&&null!==o.z?[o.lng,o.lat,o.z]:[o.lng,o.lat]}})})),n},_edgesToFlatGeoJSON:function(){var t=this,e=void 0!==r.default.TrackStats,n={type:"Feature",properties:{index:0},geometry:{type:"LineString",coordinates:[]}},o=this._getNode(this._firstNodeId);return this._nodesContainers.forEach((function(){do{var i=t._getNext(o),a=i.nextEdge,s=i.nextNode;if(void 0===o||void 0===a)break;a.getLatLngs().forEach((function(t){var o=e?r.default.TrackStats.cache.getAll(t):t;n.geometry.coordinates.push("z"in o&&null!==o.z?[o.lng,o.lat,o.z]:[o.lng,o.lat])})),o=s}while("stopover"!==o.options.type)})),n},_edgesToGeoJSON:function(){var t=this,e=void 0!==r.default.TrackStats,n=[],o=this._getNode(this._firstNodeId);return this._nodesContainers.forEach((function(i,a){var s=function(){var i=t._getNext(o),s=i.nextEdge,d=i.nextNode;if(void 0===o||void 0===s)return"break";var u=JSON.parse(JSON.stringify(s.options.metadata));u.index=a;var l={type:"Feature",properties:u,geometry:{type:"LineString",coordinates:[]}};s.getLatLngs().forEach((function(t){var n=e?r.default.TrackStats.cache.getAll(t):t;l.geometry.coordinates.push("z"in n&&null!==n.z?[n.lng,n.lat,n.z]:[n.lng,n.lat])})),n.push(l),o=d};do{if("break"===s())break}while("stopover"!==o.options.type)})),n},toGeoJSON:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={type:"FeatureCollection",features:[]};return t&&this._stopoversToGeoJSON().forEach((function(t){return n.features.push(t)})),e?n.features.push(this._edgesToFlatGeoJSON()):this._edgesToGeoJSON().forEach((function(t){return n.features.push(t)})),n},getState:function(){var t=this,e=[{version:2,start:void 0,metadata:void 0}],n=this._getNode(this._firstNodeId);return void 0!==n&&(e[0].start=m(n.getLatLng()),e[0].metadata=JSON.parse(JSON.stringify(n.options.metadata))),this._nodesContainers.forEach((function(){var r=[];do{var o=t._getNext(n),i=o.nextEdge,a=o.nextNode;if(void 0===n||void 0===i)break;r.push({end:m(a.getLatLng()),edge:_(i.getLatLngs()),metadata:{node:JSON.parse(JSON.stringify(a.options.metadata)),edge:JSON.parse(JSON.stringify(i.options.metadata))}}),n=a}while("stopover"!==n.options.type);r.length>0&&e.push(r)})),e},_fireStart:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fireEvents&&0===this._computing&&this.fire("TrackDrawer:start",t),this._computing+=1},_fireDone:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._computing-=1,this._fireEvents&&0===this._computing&&this._pushState(),this._fireEvents&&0===this._computing&&this.fire("TrackDrawer:done",t)},_fireFailed:function(t){this._computing-=1,this._fireEvents&&0===this._computing&&this.fire("TrackDrawer:failed",{message:t.message})},refreshEdges:function(t){var e=this;return d(a.mark((function n(){var r,o,i;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t||e.options.routingCallback,e._fireStart(),o=e._fireEvents,e._fireEvents=!1,i=[],e._nodesContainers.forEach((function(t){t.getLayers().forEach((function(t){i.push(e.onMoveNode(t,r))}))})),n.next=8,Promise.all(i);case 8:return e._fireEvents=o,e._fireDone(),n.abrupt("return",e);case 11:case"end":return n.stop()}}),n)})))()},clean:function(){return this._fireStart(),this._edgesContainers.clean(),this._nodesContainers.clean(),this._firstNodeId=void 0,this._lastNodeId=void 0,this._currentColorIndex=0,this._fireDone(),this},_createNode:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.default.TrackDrawer.node(t,{metadata:e})},restoreState:function(t,e){var n=this;return d(a.mark((function r(){var o,i,s,d,u,l;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e||n._createNode,n._fireStart(),i=n._fireEvents,n._fireEvents=!1,n.clean(),s=[],d=[],u=[],t.forEach((function(e,r){if(0!==r)e.forEach((function(i,a){var c=o.call(null,y(i.end),l>=2?i.metadata.node:{});a===e.length-1&&r<t.length-1&&s.push(c),u.push(n.addNode(c,(function(t,e,n){var r=v(i.edge);d.push({from:t,to:e,edge:r}),n(null,r,l>=2?i.metadata.edge:{})}),!0))}));else if(l=e.version,e.start){var i=o.call(null,y(e.start),l>=2?e.metadata:{});u.push(n.addNode(i,(function(){throw new Error("Should not be called")}),!0))}})),r.next=11,Promise.all(u);case 11:return s.forEach((function(t){return n.promoteNodeToStopover(t)})),n._fireEvents=i,n._fireDone({routes:d}),r.abrupt("return",n);case 15:case"end":return r.stop()}}),r)})))()},_pushState:function(){this.options.undoable&&!this._undoing&&(this._currentStateIndex+1!==this._states.length&&this._states.splice(this._currentStateIndex+1),this._currentStateIndex+=1,this._states.push(this.getState()),this._states.length-1>this.options.undoDepth&&(this._states.splice(0,1),this._currentStateIndex-=1))},undo:function(t){var e=this;return d(a.mark((function n(){return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.isUndoable()||0!==e._computing){n.next=7;break}return e._currentStateIndex-=1,e._undoing=!0,n.next=5,e.restoreState(e._states[e._currentStateIndex],t);case 5:return e._undoing=!1,n.abrupt("return",!0);case 7:return n.abrupt("return",!1);case 8:case"end":return n.stop()}}),n)})))()},isUndoable:function(){return this.options.undoable&&this._currentStateIndex>0},isRedoable:function(){return this.options.undoable&&this._currentStateIndex<this._states.length-1},redo:function(t){var e=this;return d(a.mark((function n(){return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.isRedoable()||0!==e._computing){n.next=7;break}return e._currentStateIndex+=1,e._undoing=!0,n.next=5,e.restoreState(e._states[e._currentStateIndex],t);case 5:return e._undoing=!1,n.abrupt("return",!0);case 7:return n.abrupt("return",!1);case 8:case"end":return n.stop()}}),n)})))()},addLayer:function(t){t instanceof r.default.Marker?this.addNode(t):r.default.LayerGroup.prototype.addLayer.call(this,t)},_createEdge:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this._edgesContainers.get(this._getNodeContainerIndex(t)),i=new g([t.getLatLng(),e.getLatLng()],{color:c.nameToRgb(t.options.colorName),dashArray:"4",metadata:r}).addTo(o),a=o.getLayerId(i);return t._routeIdNext=a,e._routeIdPrevious=a,i._startMarkerId=this._getNodeId(t),i._endMarkerId=this._getNodeId(e),i._computation=0,this.options.debug&&(i.on("tooltipopen",(function(){var t=i._startMarkerId,e=i._endMarkerId;i.setTooltipContent("id: ".concat(n._getEdgeId(i)," (on #").concat(n._getEdgeContainerIndex(i),")<br>")+"previous node: ".concat(t)+" (on #".concat(n._getNodeContainerIndex(n._getNode(t)),")<br>")+"next node: ".concat(e)+" (on #".concat(n._getNodeContainerIndex(n._getNode(e)),")"))})),i.bindTooltip("<>")),i},_prepareNode:function(t,e){var n=this;if(this.options.debug&&(t.on("tooltipopen",(function(){var e=n._getPrevious(t),r=e.previousEdge,o=e.previousNode,i=n._getNext(t),a=i.nextEdge,s=i.nextNode;t.setTooltipContent("id: ".concat(n._getNodeId(t)," (on #").concat(n._getNodeContainerIndex(t),")<br>")+"previous edge: ".concat(n._getEdgeId(r))+" (on #".concat(n._getEdgeContainerIndex(r),") to ").concat(n._getNodeId(o),"<br>")+"next edge: ".concat(n._getEdgeId(a))+" (on #".concat(n._getEdgeContainerIndex(a),") to ").concat(n._getNodeId(s)))})),t.bindTooltip("<>")),e.getLayers().length>0){var r=e.getLayers()[0];t.setStyle({colorName:r.options.colorName})}else t.setStyle({colorName:c.nameOf(this._currentColorIndex)});return t.options.draggable&&(t.on("dragstart",(function(t){return n._onDragStartNode(t.target)})),t.on("drag",(function(t){return n._onDragNode(t.target)})),t.on("moveend",(function(t){return n.onMoveNode(t.target)}))),t.addTo(e),this},addNode:function(t,e){var n=this,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e||this.options.routingCallback;if(void 0!==this._lastNodeId&&!o){var a=this._getNode(this._lastNodeId);if(a.getLatLng().equals(t.getLatLng()))return new Promise((function(t){t()}))}this._fireStart();var s=this._nodesContainers.get(-1);if(this._prepareNode(t,s),void 0!==this._lastNodeId){var d=this._getNode(this._lastNodeId);this._createEdge(d,t)}var u=this._lastNodeId;this._lastNodeId=this._getNodeId(t),void 0===this._firstNodeId&&(this._firstNodeId=this._lastNodeId);var l=this._fireEvents;if(this._fireEvents=!1,"stopover"===t.options.type&&this.promoteNodeToStopover(t),this._fireEvents=l,void 0===u)return new Promise((function(t){t()})).then((function(){n._fireDone({})}));var c=this._getPrevious(t),f=c.previousEdge,h=c.previousNode;f._computation+=1;var p=f._computation;return new Promise((function(e,n){i.call(null,h,t,(function(o,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===o?(f._computation===p&&(h.setLatLng(r.default.latLng(i[0])),t.setLatLng(r.default.latLng(i[i.length-1])),f.setLatLngs(i),f.options.metadata=JSON.parse(JSON.stringify(a)),f.setStyle({dashArray:null})),e({routes:[{from:h,to:t,previousEdge:f}]})):n(o)}))})).then((function(t){n._fireDone({routes:t})})).catch((function(t){n._fireFailed(t)}))},insertNode:function(t,e,n){var o=this,i=n||this.options.routingCallback,a=this._getNode(e._startMarkerId),s=this._getNode(e._endMarkerId);e.removeFrom(this._getEdgeContainer(e)),this._prepareNode(t,this._getNodeContainer(a));var d=this._createEdge(a,t),u=this._createEdge(t,s);this._fireStart(),d._computation+=1,u._computation+=1;var l=d._computation,c=u._computation,f=new Promise((function(e,n){i.call(null,a,t,(function(o,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===o?(d._computation===l&&(a.setLatLng(r.default.latLng(i[0])),t.setLatLng(r.default.latLng(i[i.length-1])),d.setLatLngs(i),d.options.metadata=JSON.parse(JSON.stringify(s)),d.setStyle({dashArray:null})),e({from:a,to:t,edge:d})):n(o)}))})),h=new Promise((function(e,n){i.call(null,t,s,(function(o,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===o?(u._computation===c&&(t.setLatLng(r.default.latLng(i[0])),s.setLatLng(r.default.latLng(i[i.length-1])),u.setLatLngs(i),u.options.metadata=JSON.parse(JSON.stringify(a)),u.setStyle({dashArray:null})),e({from:t,to:s,edge:u})):n(o)}))}));return Promise.all([f,h]).then((function(t){o._fireDone({routes:t})})).catch((function(t){o._fireFailed(t)}))},_onDragStartNode:function(t){var e=this._getPrevious(t).previousEdge,n=this._getNext(t).nextEdge;return void 0!==e&&e.setStyle({dashArray:"4"}),void 0!==n&&n.setStyle({dashArray:"4"}),this},_onDragNode:function(t){var e=this._getPrevious(t),n=e.previousEdge,r=e.previousNode,o=this._getNext(t),i=o.nextEdge,a=o.nextNode;return void 0!==n&&n.setLatLngs([r.getLatLng(),t.getLatLng()]),void 0!==i&&i.setLatLngs([a.getLatLng(),t.getLatLng()]),this},onMoveNode:function(t,e){var n=this,o=e||this.options.routingCallback,i=[],a=this._getPrevious(t),s=a.previousEdge,d=a.previousNode,u=this._getNext(t),l=u.nextEdge,c=u.nextNode;if(this._fireStart(),this._onDragStartNode(t),this._onDragNode(t),void 0!==s){s._computation+=1;var f=s._computation;i.push(new Promise((function(e,n){o.call(null,d,t,(function(o,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===o?(s._computation===f&&(t.setLatLng(r.default.latLng(i[i.length-1])),s.setLatLngs(i),s.options.metadata=JSON.parse(JSON.stringify(a)),s.setStyle({dashArray:null})),e({from:d,to:t,edge:s})):n(o)}))})))}if(void 0!==l){l._computation+=1;var h=l._computation;i.push(new Promise((function(e,n){o.call(null,t,c,(function(o,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===o?(l._computation===h&&(t.setLatLng(r.default.latLng(i[0])),l.setLatLngs(i),l.options.metadata=JSON.parse(JSON.stringify(a)),l.setStyle({dashArray:null})),e({from:t,to:c,edge:l})):n(o)}))})))}return Promise.all(i).then((function(t){n._fireDone({routes:t})})).catch((function(t){n._fireFailed(t)}))},removeNode:function(t,e){var n=this,r=e||this.options.routingCallback,o=[];this._fireStart();var i=this._fireEvents;this._fireEvents=!1,this.demoteNodeToWaypoint(t),this._fireEvents=i;var a=this._getNodeContainer(t),s=this._getPrevious(t),d=s.previousEdge,u=s.previousNode,l=this._getNext(t),c=l.nextEdge,f=l.nextNode;if(void 0!==d&&void 0!==c){f._routeIdPrevious=t._routeIdPrevious,d._endMarkerId=c._endMarkerId,c.removeFrom(this._getEdgeContainer(c)),t.removeFrom(a),d.setLatLngs([u.getLatLng(),f.getLatLng()]).setStyle({dashArray:"4"}),d._computation+=1;var h=d._computation;o.push(new Promise((function(t,e){r.call(null,u,f,(function(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null===n?(d._computation===h&&(d.setLatLngs(r).setStyle({dashArray:null}),d.options.metadata=JSON.parse(JSON.stringify(o))),t({from:u,to:f,edge:d})):e(n)}))})))}else void 0!==d?(u._routeIdNext=void 0,this._lastNodeId=d._startMarkerId,d.removeFrom(this._getEdgeContainer(d)),t.removeFrom(a)):void 0!==c?(f._routeIdPrevious=void 0,this._firstNodeId=c._endMarkerId,c.removeFrom(this._getEdgeContainer(c)),t.removeFrom(a)):(this._lastNodeId=void 0,this._firstNodeId=void 0,t.removeFrom(a));return Promise.all(o).then((function(t){n._fireDone({routes:t})})).catch((function(t){n._fireFailed(t)}))},promoteNodeToStopover:function(t){var e=this;if(t._promoted)return this;if(this._getNodeId(t)===this._firstNodeId)return t.setType("stopover"),t._promoted=!0,t._demoted=!1,this;this._fireStart();var n=this._getNodeContainerIndex(t),o=[],i=[],a=t;do{o.push(a);var s=this._getNext(a),d=s.nextEdge,u=s.nextNode;if(void 0===d)break;o.push(a),i.push(d),a=u}while("stopover"!==a.options.type);var l=r.default.featureGroup(),f=r.default.featureGroup();return this._nodesContainers.splice(n+1,0,l),this._edgesContainers.splice(n+1,0,f),this._currentColorIndex+=1,o.forEach((function(t){t.removeFrom(e._getNodeContainer(t)).addTo(l)})),i.forEach((function(t){t.removeFrom(e._getEdgeContainer(t)).addTo(f)})),l.setStyle({colorName:c.nameOf(this._currentColorIndex)}),f.setStyle({color:c.rgbOf(this._currentColorIndex)}),t.setType("stopover"),t._promoted=!0,t._demoted=!1,this._fireDone(),this},demoteNodeToWaypoint:function(t){var e=this;if(t._demoted)return this;var n=this._getNodeContainerIndex(t);if(0===n)return this;this._fireStart();var r=[],o=[],i=t;do{r.push(i);var a=this._getNext(i),s=a.nextEdge,d=a.nextNode;if(void 0===s)break;r.push(i),o.push(s),i=d}while("stopover"!==i.options.type);var u=this._nodesContainers.get(n-1),l=this._edgesContainers.get(n-1);this._nodesContainers.splice(n,1),this._edgesContainers.splice(n,1),r.forEach((function(t){t.removeFrom(e._getNodeContainer(t)).addTo(u)})),o.forEach((function(t){t.removeFrom(e._getEdgeContainer(t)).addTo(l)}));var c=this._getPrevious(r[0]),f=c.previousEdge,h=c.previousNode;return void 0!==f&&(u.setStyle({colorName:h.options.colorName}),l.setStyle({color:f.options.color})),t.setType("waypoint"),t._promoted=!1,t._demoted=!0,this._fireDone(),this}}),N={Track:k,track:function(t){return new k(t)}},L=i((function(t){if(void 0===r.default.Control.EasyBar)t.exports={ToolBar:void 0,toolBar:void 0};else{var e=r.default.Control.EasyBar.extend({options:{mode:null,labelAddMarker:"Add marker on click",labelInsertMarker:"Insert marker when clicking on track",labelCloseLoop:"Close the loop",labelDeleteMarker:"Delete marker on click",labelPromoteMarker:"Promote to stopover on click",labelDemoteMarker:"Demote to waypoint on click",labelClean:"Remove everything now",labelUndo:"Undo",labelRedo:"Redo"},initialize:function(t,e){var n=this;this._track=t,r.default.Util.setOptions(this,e),r.default.Control.EasyBar.prototype.initialize.call(this,this._initializeButtons(),e),this.setMode(this.options.mode),this._track.getStepsContainer().on("click",(function(t){if("insert"===n.options.mode){var e=r.default.TrackDrawer.node(t.latlng),o=t.layer;o.setStyle({weight:3}),n._track.insertNode(e,o),n._bindMarkerEvents(e)}})),this._track.getStepsContainer().on("mouseover",(function(t){"insert"===n.options.mode&&t.layer.setStyle({weight:5})})),this._track.getStepsContainer().on("mouseout",(function(t){"insert"===n.options.mode&&t.layer.setStyle({weight:3})})),this._track._toolbar=this,this._track._bindMarkerEvents=function(t){n._bindMarkerEvents(t)}},setMode:function(t){switch(this.options.mode=t,this._addBtn.state("loaded"),this._insertBtn.state("loaded"),this._deleteBtn.state("loaded"),this._promoteBtn.state("loaded"),this._demoteBtn.state("loaded"),this._map&&(this._map.getContainer().style.cursor=""),this.options.mode){case"add":this._addBtn.state("active"),this._map&&(this._map.getContainer().style.cursor="pointer");break;case"insert":this._insertBtn.state("active");break;case"delete":this._deleteBtn.state("active");break;case"promote":this._promoteBtn.state("active");break;case"demote":this._demoteBtn.state("active")}return this},_initializeButtons:function(){var t=this,e=[];return this._addBtn=r.default.easyButton({id:"trackdrawer-add",states:[{stateName:"loaded",icon:"fa-plus",title:this.options.labelAddMarker,onClick:function(){t.setMode("add")}},{stateName:"active",icon:"fa-plus",title:this.options.labelAddMarker,onClick:function(){t.setMode(null)}}]}),e.push(this._addBtn),this._insertBtn=r.default.easyButton({id:"trackdrawer-insert",states:[{stateName:"loaded",icon:"fa-plus-circle",title:this.options.labelInsertMarker,onClick:function(){t.setMode("insert")}},{stateName:"active",icon:"fa-plus-circle",title:this.options.labelInsertMarker,onClick:function(){t.setMode(null)}}]}),e.push(this._insertBtn),this._closeLoop=r.default.easyButton({id:"trackdrawer-closeloop",states:[{stateName:"loaded",icon:"fa-magic",title:this.options.labelCloseLoop,onClick:function(){if(t._track.hasNodes(2)){var e=t._track.getNodes(),n=r.default.TrackDrawer.node(e[0].markers[0].getLatLng()).addTo(t._track);t._bindMarkerEvents(n)}}}]}),e.push(this._closeLoop),this._deleteBtn=r.default.easyButton({id:"trackdrawer-delete",states:[{stateName:"loaded",icon:"fa-eraser",title:this.options.labelDeleteMarker,onClick:function(){t.setMode("delete")}},{stateName:"active",icon:"fa-eraser",title:this.options.labelDeleteMarker,onClick:function(){t.setMode(null)}}]}),e.push(this._deleteBtn),this._promoteBtn=r.default.easyButton({id:"trackdrawer-promote",states:[{stateName:"loaded",icon:"fa-pause-circle",title:this.options.labelPromoteMarker,onClick:function(){t.setMode("promote")}},{stateName:"active",icon:"fa-pause-circle",title:this.options.labelPromoteMarker,onClick:function(){t.setMode(null)}}]}),e.push(this._promoteBtn),this._demoteBtn=r.default.easyButton({id:"trackdrawer-demote",states:[{stateName:"loaded",icon:"fa-map-signs",title:this.options.labelDemoteMarker,onClick:function(){t.setMode("demote")}},{stateName:"active",icon:"fa-map-signs",title:this.options.labelDemoteMarker,onClick:function(){t.setMode(null)}}]}),e.push(this._demoteBtn),this._cleanBtn=r.default.easyButton({id:"trackdrawer-clean",states:[{icon:"fa-trash",title:this.options.labelClean,onClick:function(){t._track.clean()}}]}),e.push(this._cleanBtn),this._track.options.undoable&&(this._undoBtn=r.default.easyButton({id:"trackdrawer-undo",states:[{icon:"fa-undo",title:this.options.labelUndo,onClick:function(){t._track.undo((function(e){var n=r.default.TrackDrawer.node(e);return t._bindMarkerEvents(n),n}))}}]}),e.push(this._undoBtn),this._redoBtn=r.default.easyButton({id:"trackdrawer-redo",states:[{icon:"fa-repeat",title:this.options.labelRedo,onClick:function(){t._track.redo((function(e){var n=r.default.TrackDrawer.node(e);return t._bindMarkerEvents(n),n}))}}]}),e.push(this._redoBtn)),this._track.on("TrackDrawer:start",(function(){t._track.options.undoable&&(t._undoBtn.disable(),t._redoBtn.disable())})),this._track.on("TrackDrawer:done",(function(){t._track.hasNodes(2)?t._closeLoop.enable():t._closeLoop.disable(),t._track.hasNodes()?(t._insertBtn.enable(),t._deleteBtn.enable(),t._promoteBtn.enable(),t._demoteBtn.enable(),t._cleanBtn.enable()):(t._insertBtn.disable(),t._deleteBtn.disable(),t._promoteBtn.disable(),t._demoteBtn.disable(),t._cleanBtn.disable()),t._track.options.undoable&&(t._track.isUndoable()?t._undoBtn.enable():t._undoBtn.disable(),t._track.isRedoable()?t._redoBtn.enable():t._redoBtn.disable())})),e},_bindMarkerEvents:function(t){return t.on("click",this._onMarkerClickHandler),t.on("mouseover",this._onMarkerMouseOverHandler),t.on("mouseout",this._onMarkerMouseOutHandler),this},onAdd:function(t){var e=this;return this._onMapClickHandler=function(t){if("add"===e.options.mode){var n=r.default.TrackDrawer.node(t.latlng).addTo(e._track);e._bindMarkerEvents(n)}},this._onMarkerClickHandler=function(t){var n=t.target;switch(e.options.mode){case"delete":var r=e._track._getPrevious(n).previousEdge,o=e._track._getNext(n).nextEdge;r&&r.setStyle({weight:3}),o&&o.setStyle({weight:3}),e._track.removeNode(n);break;case"promote":e._track.promoteNodeToStopover(n);break;case"demote":e._track.demoteNodeToWaypoint(n)}},this._onMarkerMouseOverHandler=function(t){if("delete"===e.options.mode||"promote"===e.options.mode||"demote"===e.options.mode){var n=t.target,r=e._track._getPrevious(n).previousEdge,o=e._track._getNext(n).nextEdge;r&&r.setStyle({weight:5}),o&&o.setStyle({weight:5})}},this._onMarkerMouseOutHandler=function(t){var n=t.target,r=e._track._getPrevious(n).previousEdge,o=e._track._getNext(n).nextEdge;r&&r.setStyle({weight:3}),o&&o.setStyle({weight:3})},r.default.DomEvent.on(t,"click",this._onMapClickHandler),r.default.Control.EasyBar.prototype.onAdd.call(this,t)},onRemove:function(t){var e=this;"add"===this.options.mode&&(t.getContainer().style.cursor=""),r.default.DomEvent.off(t,"click",this._onMapClickHandler),this._track.getNodes().forEach((function(t){t.markers.forEach((function(t){t.off("click",e._onMarkerClickHandler),t.off("mouseover",e._onMarkerMouseOverHandler),t.off("mouseout",e._onMarkerMouseOutHandler)}))}))}});t.exports={ToolBar:e,toolBar:function(t,n){return new e(t,n)}}}})),b=i((function(t){if(void 0===r.default.Control.EasyBar)t.exports={TraceModeBar:void 0,traceModeBar:void 0};else{var e=r.default.Control.EasyBar.extend({options:{mode:null},initialize:function(t,e,n){this._track=t,this._buttonsMap={},r.default.Control.EasyBar.prototype.initialize.call(this,this._initializeButtons(e),n),this.setMode(this.options.mode)},setMode:function(t){var e=this,n=Object.keys(this._buttonsMap),r=t;null===r&&(r=n[this.options.mode===n[0]?1:0]);return this.options.mode=r,n.forEach((function(t){e._buttonsMap[t].btn.state("loaded")})),this._buttonsMap[r].btn.state("active"),this._track.setOptions({router:this._buttonsMap[r].router,routingCallback:this._buttonsMap[r].routingCallback}),this},_initializeButtons:function(t){var e=this,n=[];return t.forEach((function(t){var o=r.default.easyButton({id:"trackdrawer-mode-".concat(t.id),states:[{stateName:"loaded",icon:t.icon,title:t.name,onClick:function(){e.setMode(t.id)}},{stateName:"active",icon:t.icon,title:t.name,onClick:function(){e.setMode(null)}}]});n.push(o),e._buttonsMap[t.id]={router:t.router,routingCallback:t.routingCallback,btn:o}})),n}});t.exports={TraceModeBar:e,traceModeBar:function(t,n,r){return new e(t,n,r)}}}})),x=r.default.Marker.extend({_routeIdPrevious:void 0,_routeIdNext:void 0,_promoted:!1,_demoted:!0,options:{type:"waypoint",colorName:"blue",opacity:1,draggable:!0,metadata:{}},initialize:function(t,e){r.default.Marker.prototype.initialize.call(this,t,e),r.default.setOptions(this,e),this.setType(this.options.type),this.options.metadata=JSON.parse(JSON.stringify(this.options.metadata))},setType:function(t){return this.options.type=t,"stopover"===t?this.setIcon(r.default.AwesomeMarkers.icon({icon:"pause-circle",markerColor:this.options.colorName,prefix:"fa"})):this.setIcon(r.default.AwesomeMarkers.icon({icon:"map-signs",markerColor:this.options.colorName,prefix:"fa"})),this},setStyle:function(t){return r.default.Util.setOptions(this,t),"colorName"in t&&this.setType(this.options.type),"opacity"in t&&this.setOpacity(this.options.opacity),this}}),E={Node:x,node:function(t,e){return new x(t,e)}};function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(e<=0)throw new Error("`distance` must be positive");if(0===t.length)return[[]];var n=[];if(Array.isArray(t[0])){for(var o=0;o<t.length;o+=1)n=n.concat(w(t[o],e));return n}for(var i=t.splice(0,1);t.length>0;){var a=r.default.latLng(t.splice(0,1)[0]);i.push(a),a.distanceTo(i[0])>e&&(n.push(i),i=[a])}return n.push(i),n}function C(t){return t.getLayers().filter((function(t){return t instanceof r.default.Polyline}))}var S={splitPolyline:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return w(t.getLatLngs(),e).map((function(t){return r.default.polyline(t)}))},splitLatLngs:w,featureGroupToPolylines:C,featureGroupToLatLngs:function(t){return C(t).map((function(t){return[t.getLatLngs(),t.feature.properties]}))}},I=N.Track;I.include({_createFileLoader:function(){this._fileLoader=r.default.FileLayer.fileLoader(null,{addToMap:!1,fileSizeLimit:this.options.fileSizeLimit||1024,formats:this.options.fileFormat||[".geojson",".json",".kml",".gpx"]})},createFileLoaderControl:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._fileLoaderController=r.default.Control.fileLayerLoad({addToMap:!1,fileSizeLimit:this.options.fileSizeLimit||1024,formats:this.options.fileFormat||[".geojson",".json",".kml",".gpx"]}).addTo(this._map),this._fileLoaderController.loader.on("data:loaded",(function(n){t._dataLoadedHandler(n.layer,e)})),this._fileLoaderController},_dataLoadedHandler:function(t){var e=arguments,n=this;return d(a.mark((function o(){var i,s,d,u,l,c,f;return a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:i=e.length>1&&void 0!==e[1]&&e[1],n._fireStart(),s=n._fireEvents,n._fireEvents=!1,n.clean(),d=i?S.featureGroupToLatLngs(t).map((function(t){return[S.splitLatLngs(t[0]),t[1]]})):S.featureGroupToLatLngs(t).map((function(t){return[[t[0]],t[1]]})),l=void 0!==n._toolbar,c=a.mark((function t(e){var o,i,s;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=d[e][1],i=a.mark((function t(i){var s;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((s=d[e][0][i]).length>0)){t.next=11;break}if(void 0!==u){t.next=7;break}return u=r.default.TrackDrawer.node(s[0]),t.next=6,n.addNode(u,void 0,!0);case 6:l&&n._bindMarkerEvents(u);case 7:return u=r.default.TrackDrawer.node(s[s.length-1],{type:i===d[e][0].length-1?"stopover":"waypoint"}),t.next=10,n.addNode(u,(function(t,e,n){n(null,s,o)}),!0);case 10:l&&n._bindMarkerEvents(u);case 11:case"end":return t.stop()}}),t)})),s=0;case 3:if(!(s<d[e][0].length)){t.next=8;break}return t.delegateYield(i(s),"t0",5);case 5:s+=1,t.next=3;break;case 8:case"end":return t.stop()}}),t)})),f=0;case 9:if(!(f<d.length)){o.next=14;break}return o.delegateYield(c(f),"t0",11);case 11:f+=1,o.next=9;break;case 14:n._fireEvents=s,n._fireDone();case 16:case"end":return o.stop()}}),o)})))()},loadData:function(t,e,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((function(i,s){r._fileLoader.on("data:loaded",function(){var t=d(a.mark((function t(e){return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._dataLoadedHandler(e.layer,o);case 2:r._fileLoader.off(),i();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),r._fileLoader.on("data:error",(function(t){r._fileLoader.off(),s(t.error)})),r._fileLoader.loadData(t,e,n)}))},loadFile:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(r,o){e._fileLoader.on("data:loaded",function(){var t=d(a.mark((function t(o){return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._dataLoadedHandler(o.layer,n);case 2:e._fileLoader.off(),r();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e._fileLoader.on("data:error",(function(t){e._fileLoader.off(),o(t.error)})),e._fileLoader.load(t)}))},loadUrl:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.split("/").pop(),s=i.split(".").pop(),u=n?"fetch.php?url=".concat(encodeURI(t)):t;return new Promise((function(t,n){o.default(u,(function(o,u){if(o)if(o.responseText)try{var l=JSON.parse(o.responseText);n(new Error(l.error))}catch(t){n(new Error(o.statusText))}else o.statusText?n(new Error(o.statusText)):n(new Error(o));else try{e._fileLoader.on("data:loaded",function(){var n=d(a.mark((function n(o){return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e._dataLoadedHandler(o.layer,r);case 2:e._fileLoader.off(),t();case 4:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),e._fileLoader.on("data:error",(function(t){e._fileLoader.off(),n(t.error)})),e._fileLoader.loadData(u.responseText,i,s)}catch(t){n(t)}}),!1)}))}}),I.addInitHook("_createFileLoader");var M=N.Track,B=N.track,T=L.ToolBar,O=L.toolBar,D=b.TraceModeBar,P=b.traceModeBar,F=E.Node,A=E.node,J=p.Edge,z=p.edge;return r.default.TrackDrawer={Track:M,track:B,ToolBar:T,toolBar:O,TraceModeBar:D,traceModeBar:P,LayerContainer:f,Node:F,node:A,Edge:J,edge:z,colors:c,latlngutils:S},r.default.TrackDrawer}));
//# sourceMappingURL=leaflet.trackdrawer.umd.min.js.map
